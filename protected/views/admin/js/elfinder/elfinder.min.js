/*!
 * elFinder - file manager for web
 * Version 2.0 rc1 (2012-04-10)
 * http://elfinder.org
 * 
 * Copyright 2009-2012, Studio 42
 * Licensed under a 3 clauses BSD license
 */
window.elFinder=function(a,c){this.time("load");var b=this;a=$(a);var d=$("<div/>").append(a.contents()),e=a.attr("style"),g=a.attr("id")||"",f="elfinder-"+(g||Math.random().toString().substr(2,7)),h="mousedown."+f,j="keydown."+f,l="keypress."+f,k=!0,m=!0,p="",r={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,tmb:!1},n={},x=[],s={},y={},u=[],D=[],E=[],Q=new b.command(b),J="auto",K=400,F=$(document.createElement("audio")).hide().appendTo("body")[0],C,G=function(a){if(a.init)n=
{};else for(var c in n)n.hasOwnProperty(c)&&("directory"!=n[c].mime&&n[c].phash==p&&-1===$.inArray(c,D))&&delete n[c];p=a.cwd.hash;v(a.files);n[p]||v([a.cwd]);b.lastDir(p)},v=function(a){for(var c=a.length,d;c--;)if(d=a[c],d.name&&d.hash&&d.mime){if(!d.phash){var f="volume_"+d.name,e=b.i18n(f);f!=e&&(d.i18=e)}n[d.hash]=d}},w=new Date;this.api=null;this.oldAPI=this.newAPI=!1;this.OS=-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other";var t=!document.uniqueID&&
!window.opera&&!window.sidebar&&window.localStorage&&"undefined"==typeof window.orientation;this.UA={ltIE6:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.documentElement.style.maxHeight,ltIE7:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.querySelectorAll,ltIE8:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.getElementsByClassName,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:t,Chrome:t&&window.chrome,
Safari:t&&!window.chrome,Mobile:"undefined"!=typeof window.orientation};this.options=$.extend(!0,{},this._options,c||{});c.ui&&(this.options.ui=c.ui);c.commands&&(this.options.commands=c.commands);c.uiOptions&&c.uiOptions.toolbar&&(this.options.uiOptions.toolbar=c.uiOptions.toolbar);$.extend(this.options.contextmenu,c.contextmenu);this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get";this.customData=$.isPlainObject(this.options.customData)?this.options.customData:
{};this.id=g;this.uploadURL=c.urlUpload||c.url;this.namespace=f;this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en";g="en"==this.lang?this.i18.en:$.extend(!0,{},this.i18.en,this.i18[this.lang]);this.direction=g.direction;this.messages=g.messages;this.dateFormat=this.options.dateFormat||g.dateFormat;this.fancyFormat=this.options.fancyDateFormat||g.fancyDateFormat;this.today=(new Date(w.getFullYear(),w.getMonth(),w.getDate())).getTime()/1E3;this.yesterday=
this.today-86400;w=this.options.UTCDate?"UTC":"";this.getHours="get"+w+"Hours";this.getMinutes="get"+w+"Minutes";this.getSeconds="get"+w+"Seconds";this.getDate="get"+w+"Date";this.getDay="get"+w+"Day";this.getMonth="get"+w+"Month";this.getFullYear="get"+w+"FullYear";this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==this.direction?"rtl":"ltr")+" "+this.options.cssClass;var H;try{H="localStorage"in window&&null!==window.localStorage?
b.localStorage:b.cookie}catch(L){H=b.cookie}this.storage=H;this.viewType=this.storage("view")||this.options.defaultView||"icons";this.sortType=this.storage("sortType")||this.options.sortType||"name";this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc";this.sortStickFolders=this.storage("sortStickFolders");this.sortStickFolders=null===this.sortStickFolders?!!this.options.sortStickFolders:!!this.sortStickFolders;this.sortRules=$.extend(!0,{},this._sortRules,this.options.sortsRules);
$.each(this.sortRules,function(a,c){"function"!=typeof c&&delete b.sortRules[a]});this.compare=$.proxy(this.compare,this);this.notifyDelay=0<this.options.notifyDelay?parseInt(this.options.notifyDelay):500;this.draggable={appendTo:"body",addClasses:!0,delay:30,revert:!0,refreshPositions:!0,cursor:"move",cursorAt:{left:50,top:47},drag:function(a,b){b.helper.data("locked")||b.helper.toggleClass("elfinder-drag-helper-plus",a.shiftKey||a.ctrlKey||a.metaKey)},start:function(a,b){var c=$.map(b.helper.data("files")||
[],function(a){return a||null}),d,f;for(d=c.length;d--;)if(f=c[d],n[f].locked){b.helper.addClass("elfinder-drag-helper-plus").data("locked",!0);break}},stop:function(){b.trigger("focus").trigger("dragstop")},helper:function(a){var c=this.id?$(this):$(this).parents("[id]:first"),d=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/></div>'),f=function(a){return'<div class="elfinder-cwd-icon '+b.mime2class(a)+' ui-corner-all"/>'},e;b.trigger("dragstart",{target:c[0],originalEvent:a});
a=c.is("."+b.res("class","cwdfile"))?b.selected():[b.navId2Hash(c.attr("id"))];d.append(f(n[a[0]].mime)).data("files",a).data("locked",!1);1<(e=a.length)&&d.append(f(n[a[e-1]].mime)+'<span class="elfinder-drag-num">'+e+"</span>");return d}};this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(a,c){var d=$(this),f=$.map(c.helper.data("files")||[],function(a){return a||null}),e=[],g,h;
d.is("."+b.res("class","cwd"))?g=p:d.is("."+b.res("class","cwdfile"))?g=d.attr("id"):d.is("."+b.res("class","navdir"))&&(g=b.navId2Hash(d.attr("id")));for(d=f.length;d--;)h=f[d],h!=g&&n[h].phash!=g&&e.push(h);e.length&&(c.helper.hide(),b.clipboard(e,!(a.ctrlKey||a.shiftKey||a.metaKey||c.helper.data("locked"))),b.exec("paste",g),b.trigger("drop",{files:f}))}};this.enabled=function(){return a.is(":visible")&&k};this.visible=function(){return a.is(":visible")};this.root=function(a){for(a=n[a||p];a&&
a.phash;)a=n[a.phash];if(a)return a.hash;for(;void 0 in n&&n.hasOwnProperty(void 0);)if(a=n[void 0],!a.phash&&"directory"==!a.mime&&a.read)return a.hash;return""};this.cwd=function(){return n[p]||{}};this.option=function(a){return r[a]||""};this.file=function(a){return n[a]};this.files=function(){return $.extend(!0,{},n)};this.parents=function(a){for(var b=[];a=this.file(a);)b.unshift(a.hash),a=a.phash;return b};this.path2array=function(a,b){for(var c,d=[];a&&(c=n[a])&&c.hash;)d.unshift(b&&c.i18?
c.i18:c.name),a=c.phash;return d};this.path=function(a,b){return n[a]&&n[a].path?n[a].path:this.path2array(a,b).join(r.separator)};this.url=function(a){var b=n[a];if(!b||!b.read)return"";"1"==b.url&&this.request({data:{cmd:"url",target:a},preventFail:!0,options:{async:!1}}).done(function(a){b.url=a.url||""}).fail(function(){b.url=""});if(b.url)return b.url;if(r.url)return r.url+$.map(this.path2array(a),function(a){return encodeURIComponent(a)}).slice(1).join("/");a=$.extend({},this.customData,{cmd:"file",
target:b.hash});this.oldAPI&&(a.cmd="open",a.current=b.phash);return this.options.url+(-1===this.options.url.indexOf("?")?"?":"&")+$.param(a,!0)};this.tmb=function(a){if((a=(a=n[a])&&a.tmb&&1!=a.tmb?r.tmbUrl+a.tmb:"")&&(this.UA.Opera||this.UA.IE))a+="?_="+(new Date).getTime();return a};this.selected=function(){return x.slice(0)};this.selectedFiles=function(){return $.map(x,function(a){return n[a]?$.extend({},n[a]):null})};this.fileByName=function(a,b){for(var c in n)if(n.hasOwnProperty(c)&&n[c].phash==
b&&n[c].name==a)return n[c]};this.validResponse=function(a,b){return b.error||this.rules[this.rules[a]?a:"defaults"](b)};this.request=function(a){var b=this,c=this.options,d=$.Deferred(),f=$.extend({},c.customData,{mimes:c.onlyMimes},a.data||a),e=f.cmd,g=!(a.preventDefault||a.preventFail),h=!(a.preventDefault||a.preventDone),j=$.extend({},a.notify),l=!!a.raw,p=a.syncOnFail,k;a=$.extend({url:c.url,async:!0,type:this.requestType,dataType:"json",cache:!1,data:f},a.options||{});var c=function(a){a.warning&&
b.error(a.warning);"open"==e&&G($.extend(!0,{},a));a.removed&&a.removed.length&&b.remove(a);a.added&&a.added.length&&b.add(a);a.changed&&a.changed.length&&b.change(a);b.trigger(e,a);a.sync&&b.sync()},m;h&&d.done(c);d.fail(function(a){a&&(g?b.error(a):b.debug("error",b.i18n(a)))});if(!e)return d.reject("errCmdReq");p&&d.fail(function(a){a&&b.sync()});j.type&&j.cnt&&(k=setTimeout(function(){b.notify(j);d.always(function(){j.cnt=-(parseInt(j.cnt)||0);b.notify(j)})},b.notifyDelay),d.always(function(){clearTimeout(k)}));
if("open"==e)for(;h=E.pop();)"pending"==h.state()&&(h.quiet=!0,h.abort());delete a.preventFail;m=this.transport.send(a).fail(function(a,b){var c;switch(b){case "abort":c=a.quiet?"":["errConnect","errAbort"];break;case "timeout":c=["errConnect","errTimeout"];break;case "parsererror":c=["errResponse","errDataNotJSON"];break;default:c=403==a.status?["errConnect","errAccess"]:404==a.status?["errConnect","errNotFound"]:"errConnect"}d.reject(c,a,b)}).done(function(a){if(l)return d.resolve(a);if(a)if($.isPlainObject(a)){if(a.error)return d.reject(a.error,
m);if(!b.validResponse(e,a))return d.reject("errResponse",m)}else return d.reject(["errResponse","errDataNotJSON"],m);else return d.reject(["errResponse","errDataEmpty"],m);a=b.normalize(a);b.api||(b.api=a.api||1,b.newAPI=2<=b.api,b.oldAPI=!b.newAPI);a.options&&(r=$.extend({},r,a.options));a.netDrivers&&(b.netDrivers=a.netDrivers);d.resolve(a);a.debug&&b.debug("backend-debug",a.debug)});"open"==e&&(E.unshift(m),d.always(function(){var a=$.inArray(m,E);-1!==a&&E.splice(a,1)}));return d};this.diff=
function(a){var b={},c=[],d=[],f=[];$.each(a,function(a,c){b[c.hash]=c});$.each(n,function(a){!b[a]&&d.push(a)});$.each(b,function(a,b){var d=n[a];d?$.each(b,function(a){if(b[a]!=d[a])return f.push(b),!1}):c.push(b)});$.each(d,function(a,c){var e=n[c],g=e.phash,h;if(h=g){if(e="directory"==e.mime)if(e=-1===$.inArray(g,d))if(e=b[g]){a:{for(e=f.length;e--;)if(f[e].hash==g){e=!0;break a}e=void 0}e=!e}h=e}h&&f.push(b[g])});return{added:c,removed:d,changed:f}};this.sync=function(){var a=this,b=$.Deferred().done(function(){a.trigger("sync")}),
c={data:{cmd:"open",init:1,target:p,tree:this.ui.tree?1:0},preventDefault:!0},d={data:{cmd:"tree",target:p==this.root()?p:this.file(p).phash},preventDefault:!0};$.when(this.request(c),this.request(d)).fail(function(c){b.reject(c);c&&a.request({data:{cmd:"open",target:a.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})}).done(function(c,d){var e=a.diff(c.files.concat(d&&d.tree?d.tree:[]));e.added.push(c.cwd);e.removed.length&&a.remove(e);e.added.length&&a.add(e);e.changed.length&&
a.change(e);return b.resolve(e)});return b};this.upload=function(a){return this.transport.upload(a,this)};this.bind=function(a,b){var c;if("function"==typeof b){a=(""+a).toLowerCase().split(/\s+/);for(c=0;c<a.length;c++)void 0===s[a[c]]&&(s[a[c]]=[]),s[a[c]].push(b)}return this};this.unbind=function(a,b){var c=s[(""+a).toLowerCase()]||[],d=c.indexOf(b);-1<d&&c.splice(d,1);return this};this.trigger=function(a,b){a=a.toLowerCase();var c=s[a]||[],d;this.debug("event-"+a,b);if(c.length){a=$.Event(a);
for(d=0;d<c.length;d++){a.data=$.extend(!0,{},b);try{if(!1===c[d](a,this)||a.isDefaultPrevented()){this.debug("event-stoped",a.type);break}}catch(e){window.console&&window.console.log&&window.console.log(e)}}}return this};this.shortcut=function(a){var b,c,d,e,f;if(this.options.allowShortcuts&&a.pattern&&$.isFunction(a.callback)){b=a.pattern.toUpperCase().split(/\s+/);for(e=0;e<b.length;e++)c=b[e],f=c.split("+"),(d=1==(d=f.pop()).length?0<d?d:d.charCodeAt(0):$.ui.keyCode[d])&&!y[c]&&(y[c]={keyCode:d,
altKey:-1!=$.inArray("ALT",f),ctrlKey:-1!=$.inArray("CTRL",f),shiftKey:-1!=$.inArray("SHIFT",f),type:a.type||"keydown",callback:a.callback,description:a.description,pattern:c})}return this};this.shortcuts=function(){var a=[];$.each(y,function(c,d){a.push([d.pattern,b.i18n(d.description)])});return a};this.clipboard=function(a,b){var c=function(){return $.map(u,function(a){return a.hash})};void 0!==a&&(u.length&&this.trigger("unlockfiles",{files:c()}),D=[],u=$.map(a||[],function(a){var c=n[a];return c?
(D.push(a),{hash:a,phash:c.phash,name:c.name,mime:c.mime,read:c.read,locked:c.locked,cut:!!b}):null}),this.trigger("changeclipboard",{clipboard:u.slice(0,u.length)}),b&&this.trigger("lockfiles",{files:c()}));return u.slice(0,u.length)};this.isCommandEnabled=function(a){return this._commands[a]?-1===$.inArray(a,r.disabled):!1};this.exec=function(a,b,c){return this._commands[a]&&this.isCommandEnabled(a)?this._commands[a].exec(b,c):$.Deferred().reject("No such command")};this.dialog=function(b,c){return $("<div/>").append(b).appendTo(a).elfinderdialog(c)};
this.getUI=function(b){return this.ui[b]||a};this.command=function(a){return void 0===a?this._commands:this._commands[a]};this.resize=function(b,c){a.css("width",b).height(c).trigger("resize");this.trigger("resize",{width:a.width(),height:a.height()})};this.restoreSize=function(){this.resize(J,K)};this.show=function(){a.show();this.enable().trigger("show")};this.hide=function(){this.disable().trigger("hide");a.hide()};this.destroy=function(){a&&a[0].elfinder&&(this.trigger("destroy").disable(),s=
{},y={},$(document).add(a).unbind("."+this.namespace),b.trigger=function(){},a.children().remove(),a.append(d.contents()).removeClass(this.cssClass).attr("style",e),a[0].elfinder=null,C&&clearInterval(C))};if(!$.fn.selectable||!$.fn.draggable||!$.fn.droppable)return alert(this.i18n("errJqui"));if(!a.length)return alert(this.i18n("errNode"));if(!this.options.url)return alert(this.i18n("errURL"));$.extend($.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120});this.dragUpload=
!1;this.xhrUpload="undefined"!=typeof XMLHttpRequestUpload&&"undefined"!=typeof File&&"undefined"!=typeof FormData;this.transport={};"object"==typeof this.options.transport&&(this.transport=this.options.transport,"function"==typeof this.transport.init&&this.transport.init(this));"function"!=typeof this.transport.send&&(this.transport.send=function(a){return $.ajax(a)});"iframe"==this.transport.upload?this.transport.upload=$.proxy(this.uploads.iframe,this):"function"==typeof this.transport.upload?
this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload?(this.transport.upload=$.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=$.proxy(this.uploads.iframe,this);this.error=function(){var a=arguments[0];return 1==arguments.length&&"function"==typeof a?b.bind("error",a):b.trigger("error",{error:a})};$.each("enable disable load open reload select add remove change dblclick getfile lockfiles unlockfiles dragstart dragstop search searchend viewchange".split(" "),function(a,
c){b[c]=function(){var a=arguments[0];return 1==arguments.length&&"function"==typeof a?b.bind(c,a):b.trigger(c,$.isPlainObject(a)?a:{})}});this.enable(function(){!k&&(b.visible()&&b.ui.overlay.is(":hidden"))&&(k=!0,$("texarea:focus,input:focus,button").blur(),a.removeClass("elfinder-disabled"))}).disable(function(){m=k;k=!1;a.addClass("elfinder-disabled")}).open(function(){x=[]}).select(function(a){x=$.map(a.data.selected||a.data.value||[],function(a){return n[a]?a:null})}).error(function(a){var c=
{cssClass:"elfinder-dialog-error",title:b.i18n(b.i18n("error")),resizable:!1,destroyOnClose:!0,buttons:{}};c.buttons[b.i18n(b.i18n("btnClose"))]=function(){$(this).elfinderdialog("close")};b.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+b.i18n(a.data.error),c)}).bind("tree parents",function(a){v(a.data.tree||[])}).bind("tmb",function(a){$.each(a.data.images||[],function(a,b){n[a]&&(n[a].tmb=b)})}).add(function(a){v(a.data.added||[])}).change(function(a){$.each(a.data.changed||
[],function(a,b){var c=b.hash;n[c]=n[c]?$.extend(n[c],b):b})}).remove(function(a){a=a.data.removed||[];for(var b=a.length,c=function(a){var b=n[a];b&&("directory"==b.mime&&b.dirs&&$.each(n,function(b,d){d.phash==a&&c(b)}),delete n[a])};b--;)c(a[b])}).bind("search",function(a){v(a.data.files)}).bind("rm",function(){var a=F.canPlayType&&F.canPlayType('audio/wav; codecs="1"');a&&""!=a&&"no"!=a&&$(F).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play()});$.each(this.options.handlers,function(a,
c){b.bind(a,c)});this.history=new this.history(this);"function"==typeof this.options.getFileCallback&&this.commands.getfile&&(this.bind("dblclick",function(a){a.preventDefault();b.exec("getfile").fail(function(){b.exec("open")})}),this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){b.exec("getfile").fail(function(){b.exec("mac"==b.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n("mac"==this.OS?"cmdrename":"cmdopen"),callback:function(){b.exec("mac"==
b.OS?"rename":"open")}}));this._commands={};$.isArray(this.options.commands)||(this.options.commands=[]);$.each("open reload back forward up home info quicklook getfile help".split(" "),function(a,c){-1===$.inArray(c,b.options.commands)&&b.options.commands.push(c)});$.each(this.options.commands,function(a,c){var d=b.commands[c];$.isFunction(d)&&!b._commands[c]&&(d.prototype=Q,b._commands[c]=new d,b._commands[c].setup(c,b.options.commandsOptions[c]||{}))});a.addClass(this.cssClass).bind(h,function(){!k&&
b.enable()});this.ui={workzone:$("<div/>").appendTo(a).elfinderworkzone(this),navbar:$("<div/>").appendTo(a).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:$("<div/>").appendTo(a).elfindercontextmenu(this),overlay:$("<div/>").appendTo(a).elfinderoverlay({show:function(){b.disable()},hide:function(){m&&b.enable()}}),cwd:$("<div/>").appendTo(a).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},
resizable:!1,autoOpen:!1,title:"&nbsp;",width:280}),statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(a)};$.each(this.options.ui||[],function(c,d){var e="elfinder"+d,f=b.options.uiOptions[d]||{};!b.ui[d]&&$.fn[e]&&(b.ui[d]=$("<"+(f.tag||"div")+"/>").appendTo(a)[e](b,f))});a[0].elfinder=this;this.options.resizable&&$.fn.resizable&&a.resizable({handles:"se",minWidth:300,minHeight:200});this.options.width&&(J=this.options.width);this.options.height&&
(K=parseInt(this.options.height));b.resize(J,K);$(document).bind("click."+this.namespace,function(c){k&&!$(c.target).closest(a).length&&b.disable()}).bind(j+" "+l,function(a){var c=a.keyCode,d=!(!a.ctrlKey&&!a.metaKey);k&&($.each(y,function(e,f){f.type==a.type&&(f.keyCode==c&&f.shiftKey==a.shiftKey&&f.ctrlKey==d&&f.altKey==a.altKey)&&(a.preventDefault(),a.stopPropagation(),f.callback(a,b),b.debug("shortcut-exec",e+" : "+f.description))}),9==c&&!$(a.target).is(":input")&&a.preventDefault())});this.trigger("init").request({data:{cmd:"open",
target:b.lastDir(),init:1,tree:this.ui.tree?1:0},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){b.trigger("fail").disable().lastDir("");s={};y={};$(document).add(a).unbind("."+this.namespace);b.trigger=function(){}}).done(function(a){b.load().debug("api",b.api);a=$.extend(!0,{},a);G(a);b.trigger("open",a)});this.one("load",function(){a.trigger("resize");1E3<b.options.sync&&(C=setInterval(function(){b.sync()},b.options.sync))})};
elFinder.prototype={res:function(a,c){return this.resources[a]&&this.resources[a][c]},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),daysShort:"Sun Mon Tue Wed Thu Fri Sat".split(" ")},
kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord",
"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP",
"application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP",
"application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO",
"application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF",
"application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML",
"text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF",
"image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash",
"video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(a){return!a||a.added&&!$.isArray(a.added)||a.removed&&!$.isArray(a.removed)||a.changed&&!$.isArray(a.changed)?!1:!0},open:function(a){return a&&a.cwd&&a.files&&$.isPlainObject(a.cwd)&&$.isArray(a.files)},tree:function(a){return a&&a.tree&&$.isArray(a.tree)},parents:function(a){return a&&a.tree&&$.isArray(a.tree)},tmb:function(a){return a&&a.images&&($.isPlainObject(a.images)||$.isArray(a.images))},upload:function(a){return a&&
($.isPlainObject(a.added)||$.isArray(a.added))},search:function(a){return a&&a.files&&$.isArray(a.files)}},commands:{},parseUploadData:function(a){var c;if(!$.trim(a))return{error:["errResponse","errDataEmpty"]};try{c=$.parseJSON(a)}catch(b){return{error:["errResponse","errDataNotJSON"]}}if(!this.validResponse("upload",c))return{error:["errResponse"]};c=this.normalize(c);c.removed=$.map(c.added||[],function(a){return a.hash});return c},iframeCnt:0,uploads:{checkFile:function(a){if("files"==a.type)return a.files;
var c=[],b=a.files[0];if("html"==a.type){a=/<img[^>]+src=["']?([^"'> ]+)/ig;for(var d=[],d="";d=a.exec(b);)d=d[1].replace(/&amp;/g,"&"),d.match(/^http/)&&-1==$.inArray(d,c)&&c.push(d);if((a=b.match(/<\/a>/i))&&1==a.length)if(a=/<a[^>]+href=["']?([^"'> ]+)((?:.|\s)+)<\/a>/i,(d=a.exec(b))&&!d[2].match(/<img/i))d=d[1].replace(/&amp;/g,"&"),d.match(/^http/)&&-1==$.inArray(d,c)&&c.push(d)}else for(a=/(http[^<>"{}|\\^\[\]`\s]+)/ig;d=a.exec(b);)d=d[1].replace(/&amp;/g,"&"),-1==$.inArray(d,c)&&c.push(d);
return c},iframe:function(a,c){var b=c?c:this,d=a.input?a.input:!1,e=!d?b.uploads.checkFile(a):!1,g=$.Deferred().fail(function(a){a&&b.error(a)}).done(function(a){a.warning&&b.error(a.warning);a.removed&&b.remove(a);a.added&&b.add(a);a.changed&&b.change(a);b.trigger("upload",a);a.sync&&b.sync()}),f="iframe-"+b.namespace+ ++b.iframeCnt,h=$('<form action="'+b.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+f+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),
j=this.UA.IE,l=function(){n&&clearTimeout(n);r&&clearTimeout(r);p&&b.notify({type:"upload",cnt:-m});setTimeout(function(){j&&$('<iframe src="javascript:false;"/>').appendTo(h);h.remove();k.remove()},100)},k=$('<iframe src="'+(j?"javascript:false;":"about:blank")+'" name="'+f+'" style="position:absolute;left:-1000px;top:-1000px" />').bind("load",function(){k.unbind("load").bind("load",function(){var a=b.parseUploadData(k.contents().text());l();a.error?g.reject(a.error):g.resolve(a)});r=setTimeout(function(){p=
!0;b.notify({type:"upload",cnt:m})},b.options.notifyDelay);0<b.options.iframeTimeout&&(n=setTimeout(function(){l();g.reject([errors.connect,errors.timeout])},b.options.iframeTimeout));h.submit()}),m,p,r,n;if(e&&e.length)$.each(e,function(a,b){h.append('<input type="hidden" name="upload[]" value="'+b+'"/>')}),m=1;else if(d&&$(d).is(":file")&&$(d).val())h.append(d),m=d.files?d.files.length:1;else return g.reject();h.append('<input type="hidden" name="'+(b.newAPI?"target":"current")+'" value="'+b.cwd().hash+
'"/>').append('<input type="hidden" name="html" value="1"/>').append($(d).attr("name","upload[]"));$.each(b.options.onlyMimes||[],function(a,b){h.append('<input type="hidden" name="mimes[]" value="'+b+'"/>')});$.each(b.options.customData,function(a,b){h.append('<input type="hidden" name="'+a+'" value="'+b+'"/>')});h.appendTo("body");k.appendTo("body");return g},xhr:function(a,c){var b=c?c:this,d=$.Deferred().fail(function(a){a&&b.error(a)}).done(function(a){a.warning&&b.error(a.warning);a.removed&&
b.remove(a);a.added&&b.add(a);a.changed&&b.change(a);b.trigger("upload",a);a.sync&&b.sync()}).always(function(){m&&clearTimeout(m);l&&b.notify({type:"upload",cnt:-h,progress:100*h})}),e=new XMLHttpRequest,g=new FormData,f=a.input?a.input.files:b.uploads.checkFile(a),h=f.length,j=5,l=!1,k=function(){return setTimeout(function(){l=!0;b.notify({type:"upload",cnt:h,progress:j*h})},b.options.notifyDelay)},m;if(!h)return d.reject();e.addEventListener("error",function(){d.reject("errConnect")},!1);e.addEventListener("abort",
function(){d.reject(["errConnect","errAbort"])},!1);e.addEventListener("load",function(){var a=e.status;if(500<a)return d.reject("errResponse");if(200!=a)return d.reject("errConnect");if(4!=e.readyState)return d.reject(["errConnect","errTimeout"]);if(!e.responseText)return d.reject(["errResponse","errDataEmpty"]);a=b.parseUploadData(e.responseText);a.error?d.reject(a.error):d.resolve(a)},!1);e.upload.addEventListener("progress",function(a){var c=j;a.lengthComputable&&(a=parseInt(100*a.loaded/a.total),
0<a&&!m&&(m=k()),4<a-c&&(j=a,l&&b.notify({type:"upload",cnt:0,progress:(j-c)*h})))},!1);e.open("POST",b.uploadURL,!0);g.append("cmd","upload");g.append(b.newAPI?"target":"current",b.cwd().hash);$.each(b.options.customData,function(a,b){g.append(a,b)});$.each(b.options.onlyMimes,function(a,b){g.append("mimes["+a+"]",b)});$.each(f,function(a,b){g.append("upload[]",b)});e.onreadystatechange=function(){4==e.readyState&&0==e.status&&d.reject(["errConnect","errAbort"])};e.send(g);if(!this.UA.Safari||!a.files)m=
k();return d}},one:function(a,c){var b=this,d=$.proxy(c,function(a){setTimeout(function(){b.unbind(a.type,d)},3);return c.apply(this,arguments)});return this.bind(a,d)},localStorage:function(a,c){var b=window.localStorage;a="elfinder-"+a+this.id;if(null===c)return console.log("remove",a),b.removeItem(a);if(void 0!==c)try{b.setItem(a,c)}catch(d){b.clear(),b.setItem(a,c)}return b.getItem(a)},cookie:function(a,c){var b,d;a="elfinder-"+a+this.id;if(void 0===c){if(document.cookie&&""!=document.cookie){b=
document.cookie.split(";");a+="=";for(d=0;d<b.length;d++)if(b[d]=$.trim(b[d]),b[d].substring(0,a.length)==a)return decodeURIComponent(b[d].substring(a.length))}return""}d=$.extend({},this.options.cookie);null===c&&(c="",d.expires=-1);"number"==typeof d.expires&&(b=new Date,b.setTime(b.getTime()+864E5*d.expires),d.expires=b);document.cookie=a+"="+encodeURIComponent(c)+"; expires="+d.expires.toUTCString()+(d.path?"; path="+d.path:"")+(d.domain?"; domain="+d.domain:"")+(d.secure?"; secure":"");return c},
lastDir:function(a){return this.options.rememberLastDir?this.storage("lastdir",a):""},_node:$("<span/>"),escape:function(a){return this._node.text(a).html()},normalize:function(a){var c=function(a){return a&&a.hash&&a.name&&a.mime?("application/x-empty"==a.mime&&(a.mime="text/plain"),a):null};a.files&&(a.files=$.map(a.files,c));a.tree&&(a.tree=$.map(a.tree,c));a.added&&(a.added=$.map(a.added,c));a.changed&&(a.changed=$.map(a.changed,c));a.api&&(a.init=!0);return a},setSort:function(a,c,b){this.storage("sortType",
this.sortType=this.sortRules[a]?a:"name");this.storage("sortOrder",this.sortOrder=/asc|desc/.test(c)?c:"asc");this.storage("sortStickFolders",(this.sortStickFolders=!!b)?1:"");this.trigger("sortchange")},_sortRules:{name:function(a,c){return a.name.toLowerCase().localeCompare(c.name.toLowerCase())},size:function(a,c){var b=parseInt(a.size)||0,d=parseInt(c.size)||0;return b==d?0:b>d?1:-1},kind:function(a,c){return a.mime.localeCompare(c.mime)},date:function(a,c){var b=a.ts||a.date,d=c.ts||c.date;return b==
d?0:b>d?1:-1}},compare:function(a,c){var b=this.sortType,d="asc"==this.sortOrder,e=this.sortRules,g=e[b],f="directory"==a.mime,h="directory"==c.mime;if(this.sortStickFolders){if(f&&!h)return-1;if(!f&&h)return 1}g=d?g(a,c):g(c,a);return"name"!=b&&0==g?d?e.name(a,c):e.name(c,a):g},sortFiles:function(a){return a.sort(this.compare)},notify:function(a){var c=a.type,b=this.messages["ntf"+c]?this.i18n("ntf"+c):this.i18n("ntfsmth"),d=this.ui.notify,e=d.children(".elfinder-notify-"+c),g=a.cnt,f=0<=a.progress&&
100>=a.progress?a.progress:0,h;if(!c)return this;e.length||(e=$('<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div></div>'.replace(/\{type\}/g,c).replace(/\{msg\}/g,b)).appendTo(d).data("cnt",0),f&&e.data({progress:0,total:0}));c=g+parseInt(e.data("cnt"));if(0<c){if(!a.hideCnt&&
e.children(".elfinder-notify-cnt").text("("+c+")"),d.is(":hidden")&&d.elfinderdialog("open"),e.data("cnt",c),100>f&&0<=e.data("total")&&0<=(h=e.data("progress")))a=g+parseInt(e.data("total")),h=f+h,f=parseInt(h/a),e.data({progress:h,total:a}),d.find(".elfinder-notify-progress").animate({width:(100>f?f:100)+"%"},20)}else e.remove(),!d.children().length&&d.elfinderdialog("close");return this},confirm:function(a){var c=!1,b={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(a.title||
"confirmReq"),buttons:{},close:function(){!c&&a.cancel.callback();$(this).elfinderdialog("destroy")}},d=this.i18n("apllyAll"),e;a.reject&&(b.buttons[this.i18n(a.reject.label)]=function(){a.reject.callback(!(!e||!e.prop("checked")));c=!0;$(this).elfinderdialog("close")});b.buttons[this.i18n(a.accept.label)]=function(){a.accept.callback(!(!e||!e.prop("checked")));c=!0;$(this).elfinderdialog("close")};b.buttons[this.i18n(a.cancel.label)]=function(){$(this).elfinderdialog("close")};a.all&&(a.reject&&
(b.width=370),b.create=function(){e=$('<input type="checkbox" />');$(this).next().children().before($("<label>"+d+"</label>").prepend(e))},b.open=function(){var a=$(this).next(),b=parseInt(a.children(":first").outerWidth()+a.children(":last").outerWidth());b>parseInt(a.width())&&$(this).closest(".elfinder-dialog").width(b+30)});return this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(a.text),b)},uniqueName:function(a,c){var b=0,d="",e;a=this.i18n(a);c=c||this.cwd().hash;
if(-1!=(e=a.indexOf(".txt")))d=".txt",a=a.substr(0,e);e=a+d;if(!this.fileByName(e,c))return e;for(;1E4>b;)if(e=a+" "+ ++b+d,!this.fileByName(e,c))return e;return a+Math.random()+d},i18n:function(){var a=this,c=this.messages,b=[],d=[],e=function(b){var c;return 0===b.indexOf("#")&&(c=a.file(b.substr(1)))?c.name:b},g,f,h;for(g=0;g<arguments.length;g++)if(h=arguments[g],"string"==typeof h)b.push(e(h));else if($.isArray(h))for(f=0;f<h.length;f++)"string"==typeof h[f]&&b.push(e(h[f]));for(g=0;g<b.length;g++)-1===
$.inArray(g,d)&&(h=b[g],h=c[h]||h,h=h.replace(/\$(\d+)/g,function(a,c){c=g+parseInt(c);0<c&&b[c]&&d.push(c);return b[c]||""}),b[g]=h);return $.map(b,function(a,b){return-1===$.inArray(b,d)?a:null}).join("<br>")},mime2class:function(a){a=a.split("/");return"elfinder-cwd-icon-"+a[0]+("image"!=a[0]&&a[1]?" elfinder-cwd-icon-"+a[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(a){var c="object"==typeof a?a.mime:a;a=a.alias?"Alias":this.kinds[c]?this.kinds[c]:0===c.indexOf("text")?"Text":0===c.indexOf("image")?
"Image":0===c.indexOf("audio")?"Audio":0===c.indexOf("video")?"Video":0===c.indexOf("application")?"App":c;return this.messages["kind"+a]?this.i18n("kind"+a):c},formatDate:function(a,c){var b=this;c=c||a.ts;var d=b.i18,e,g,f,h,j,l,k,m,p;return b.options.clientFormatDate&&0<c?(e=new Date(1E3*c),l=e[b.getHours](),k=12<l?l-12:l,m=e[b.getMinutes](),p=e[b.getSeconds](),g=e[b.getDate](),f=e[b.getDay](),h=e[b.getMonth]()+1,j=e[b.getFullYear](),e=c>=this.yesterday?this.fancyFormat:this.dateFormat,e=e.replace(/[a-z]/gi,
function(a){switch(a){case "d":return 9<g?g:"0"+g;case "j":return g;case "D":return b.i18n(d.daysShort[f]);case "l":return b.i18n(d.days[f]);case "m":return 9<h?h:"0"+h;case "n":return h;case "M":return b.i18n(d.monthsShort[h-1]);case "F":return b.i18n(d.months[h-1]);case "Y":return j;case "y":return(""+j).substr(2);case "H":return 9<l?l:"0"+l;case "G":return l;case "g":return k;case "h":return 9<k?k:"0"+k;case "a":return 12<l?"pm":"am";case "A":return 12<l?"PM":"AM";case "i":return 9<m?m:"0"+m;case "s":return 9<
p?p:"0"+p}return a}),c>=this.yesterday?e.replace("$1",this.i18n(c>=this.today?"Today":"Yesterday")):e):a.date?a.date.replace(/([a-z]+)\s/i,function(a,c){return b.i18n(c)+" "}):b.i18n("dateUnknown")},perms2class:function(a){var c="";!a.read&&!a.write?c="elfinder-na":a.read?a.write||(c="elfinder-ro"):c="elfinder-wo";return c},formatPermissions:function(a){var c=[];a.read&&c.push(this.i18n("read"));a.write&&c.push(this.i18n("write"));return c.length?c.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},
formatSize:function(a){var c=1,b="b";if("unknown"==a)return this.i18n("unknown");1073741824<a?(c=1073741824,b="GB"):1048576<a?(c=1048576,b="MB"):1024<a&&(c=1024,b="KB");a/=c;return(0<a?1048576<=c?a.toFixed(2):Math.round(a):0)+" "+b},navHash2Id:function(a){return"nav-"+a},navId2Hash:function(a){return"string"==typeof a?a.substr(4):!1},log:function(a){window.console&&window.console.log&&window.console.log(a);return this},debug:function(a,c){var b=this.options.debug;("all"==b||!0===b||$.isArray(b)&&
-1!=$.inArray(a,b))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+a+"] ["+this.id+"]",c);return this},time:function(a){window.console&&window.console.time&&window.console.time(a)},timeEnd:function(a){window.console&&window.console.timeEnd&&window.console.timeEnd(a)}};elFinder.prototype.version="2.0 rc1";
$.fn.elfinder=function(a){return"instance"==a?this.getElFinder():this.each(function(){var c="string"==typeof a?a:"";this.elfinder||new elFinder(this,"object"==typeof a?a:{});switch(c){case "close":case "hide":this.elfinder.hide();break;case "open":case "show":this.elfinder.show();break;case "destroy":this.elfinder.destroy()}})};$.fn.getElFinder=function(){var a;this.each(function(){if(this.elfinder)return a=this.elfinder,!1});return a};
elFinder.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",iframeTimeout:0,customData:{},handlers:{},lang:"en",cssClass:"",commands:"open reload home up back forward getfile quicklook download rm duplicate rename mkdir mkfile upload copy cut paste edit extract archive search info view help resize sort netmount netunmount pixlr".split(" "),commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:""},upload:{ui:"uploadbutton"},quicklook:{autoplay:!0,
jplayer:"extensions/jplayer"},edit:{mimes:[],editors:[]},netmount:{ftp:{inputs:{host:$('<input type="text"/>'),port:$('<input type="text"/>'),path:$('<input type="text" value="/"/>'),user:$('<input type="text"/>'),pass:$('<input type="password"/>')}},dropbox:{inputs:{host:$('<span id="elfinder-cmd-netmout-dropbox-host"><span class="elfinder-info-spinner"/></span></span><input type="hidden" value="dropbox"/>'),path:$('<input type="text" value="/"/>'),user:$('<input id="elfinder-cmd-netmout-dropbox-user" type="hidden"/>'),
pass:$('<input id="elfinder-cmd-netmout-dropbox-pass" type="hidden"/>')},select:function(a){$("#elfinder-cmd-netmout-dropbox-host").find("span").length&&a.request({data:{cmd:"netmount",protocol:"dropbox",host:"dropbox.com",user:"init",pass:"init",options:{url:a.uploadURL}},preventDefault:!0}).done(function(c){$("#elfinder-cmd-netmout-dropbox-host").html(c.body.replace(/\{msg:([^}]+)\}/g,function(b,c){return a.i18n(c,"Dropbox.com")}))}).fail(function(){})}}},help:{view:["about","shortcuts","help"]}},
getFileCallback:null,defaultView:"icons",ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit","resize","pixlr"],["extract","archive"],["search"],["view","sort"],["help"]],tree:{openRootOnLoad:!0,syncTree:!0},navbar:{minWidth:150,maxWidth:500},cwd:{oldSchool:!1}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,
clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",width:"auto",height:400,resizable:!0,notifyDelay:500,allowShortcuts:!0,rememberLastDir:!0,showFiles:30,showThreshold:50,validName:!1,sync:0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:"open | copy cut paste duplicate | rm | info netunmount".split(" "),cwd:"reload back | upload mkdir mkfile paste | sort | info".split(" "),files:"getfile | open quicklook | download | copy cut paste duplicate | rm | edit rename resize pixlr | archive extract | info".split(" ")},
debug:["error","warning","event-destroy"]};
elFinder.prototype.history=function(a){var c=this,b=!0,d=[],e,g=function(){d=[a.cwd().hash];e=0;b=!0},f=function(f){return f&&c.canForward()||!f&&c.canBack()?(b=!1,a.exec("open",d[f?++e:--e]).fail(g)):$.Deferred().reject()};this.canBack=function(){return 0<e};this.canForward=function(){return e<d.length-1};this.back=f;this.forward=function(){return f(!0)};a.open(function(){var c=d.length,f=a.cwd().hash;b&&(0<=e&&c>e+1&&d.splice(e+1),d[d.length-1]!=f&&d.push(f),e=d.length-1);b=!0}).reload(g)};
elFinder.prototype.command=function(a){this.fm=a;this.title=this.name="";this.state=-1;this.disableOnSearch=this._disabled=this.alwaysEnabled=!1;this.updateOnSelect=!0;this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));this.update(void 0,this.value);this.change()}};this.handlers={};this.shortcuts=[];this.options={ui:"button"};this.setup=
function(a,b){var d=this,e=this.fm,g,f;this.name=a;this.title=e.messages["cmd"+a]?e.i18n("cmd"+a):a;this.options=$.extend({},this.options,b);this.listeners=[];this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)});$.each($.extend({},d._handlers,d.handlers),function(a,b){e.bind(a,$.proxy(b,d))});for(g=0;g<this.shortcuts.length;g++)f=this.shortcuts[g],f.callback=$.proxy(f.callback||function(){this.exec()},this),!f.description&&(f.description=this.title),e.shortcut(f);
this.disableOnSearch&&e.bind("search searchend",function(a){d._disabled="search"==a.type;d.update(void 0,d.value)});this.init()};this.init=function(){};this.exec=function(){return $.Deferred().reject()};this.disabled=function(){return 0>this.state};this.enabled=function(){return-1<this.state};this.active=function(){return 0<this.state};this.getstate=function(){return-1};this.update=function(a,b){var d=this.state,e=this.value;this.state=this._disabled?-1:void 0!==a?a:this.getstate();this.value=b;(d!=
this.state||e!=this.value)&&this.change()};this.change=function(a){var b;if("function"===typeof a)this.listeners.push(a);else for(b=0;b<this.listeners.length;b++){a=this.listeners[b];try{a(this.state,this.value)}catch(d){this.fm.debug("error",d)}}return this};this.hashes=function(c){return c?$.map($.isArray(c)?c:[c],function(b){return a.file(b)?b:null}):a.selected()};this.files=function(a){var b=this.fm;return a?$.map($.isArray(a)?a:[a],function(a){return b.file(a)||null}):b.selectedFiles()}};
elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",
treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree"/></div>'},
mimes:{text:"application/x-empty application/javascript application/xhtml+xml audio/x-mp3-playlist application/x-web-config application/docbook+xml application/x-php application/x-perl application/x-awk application/x-config application/x-csh application/xml".split(" ")},mixin:{make:function(){var a=this.fm,c=this.name,b=a.getUI("cwd"),d=$.Deferred().fail(function(c){b.trigger("unselectall");c&&a.error(c)}).always(function(){j.remove();h.remove();a.enable()}),e="tmp_"+parseInt(1E5*Math.random()),g=
a.cwd().hash,f=new Date,f={hash:e,name:a.uniqueName(this.prefix),mime:this.mime,read:!0,write:!0,date:"Today "+f.getHours()+":"+f.getMinutes()},h=b.trigger("create."+a.namespace,f).find("#"+e),j=$('<input type="text"/>').keydown(function(a){a.stopImmediatePropagation();a.keyCode==$.ui.keyCode.ESCAPE?d.reject():a.keyCode==$.ui.keyCode.ENTER&&j.blur()}).mousedown(function(a){a.stopPropagation()}).blur(function(){var b=$.trim(j.val()),f=j.parent();if(f.length){if(!b)return d.reject("errInvName");if(a.fileByName(b,
g))return d.reject(["errExists",b]);f.html(a.escape(b));a.lockfiles({files:[e]});a.request({data:{cmd:c,name:b,target:g},notify:{type:c,cnt:1},preventFail:!0,syncOnFail:!0}).fail(function(a){d.reject(a)}).done(function(a){d.resolve(a)})}});if(this.disabled()||!h.length)return d.reject();a.disable();h.find(".elfinder-cwd-filename").empty("").append(j.val(f.name));j.select().focus();return d}}};
$.fn.dialogelfinder=function(a){this.not(".elfinder").each(function(){$(document);var b=$('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(a.title||"Files")+"</div>");$('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').appendTo(b).click(function(a){a.preventDefault();c.dialogelfinder("close")});var c=$(this).addClass("dialogelfinder").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",
containment:"window"}).elfinder(a).prepend(b);c.elfinder("instance");c.width(parseInt(c.width())||840).data("elfinderDestroyOnClose",!!a.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top");a.position&&c.data("elfinderPosition",a.position);!1!==a.autoOpen&&$(this).dialogelfinder("open")});if("open"==a){var c=$(this),b=c.data("elfinderPosition")||{top:parseInt($(document).scrollTop()+($(window).height()<c.height()?2:($(window).height()-c.height())/2)),left:parseInt($(document).scrollLeft()+
($(window).width()<c.width()?2:($(window).width()-c.width())/2))},d=100;c.is(":hidden")&&($("body").find(":visible").each(function(){var a=$(this),b;if(this!==c[0]&&"absolute"==a.css("position")&&(b=parseInt(a.zIndex()))>d)d=b+1}),c.zIndex(d).css(b).show().trigger("resize"),setTimeout(function(){c.trigger("resize").mousedown()},200))}else if("close"==a)c=$(this),c.is(":visible")&&(c.data("elfinderDestroyOnClose")?c.elfinder("destroy").remove():c.elfinder("close"));else if("instance"==a)return $(this).getElFinder();
return this};
elFinder&&(elFinder.prototype&&"object"==typeof elFinder.prototype.i18)&&(elFinder.prototype.i18.en={translator:"Troex Nevelin &lt;troex@fury.scancode.ru&gt;",language:"English",direction:"ltr",dateFormat:"M d, Y h:i A",fancyDateFormat:"$1 h:i A",messages:{error:"Error",errUnknown:"Unknown error.",errUnknownCmd:"Unknown command.",errJqui:"Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.",errNode:"elFinder requires DOM Element to be created.",errURL:"Invalid elFinder configuration! URL option is not set.",
errAccess:"Access denied.",errConnect:"Unable to connect to backend.",errAbort:"Connection aborted.",errTimeout:"Connection timeout.",errNotFound:"Backend not found.",errResponse:"Invalid backend response.",errConf:"Invalid backend configuration.",errJSON:"PHP JSON module not installed.",errNoVolumes:"Readable volumes not available.",errCmdParams:'Invalid parameters for command "$1".',errDataNotJSON:"Data is not JSON.",errDataEmpty:"Data is empty.",errCmdReq:"Backend request requires command name.",
errOpen:'Unable to open "$1".',errNotFolder:"Object is not a folder.",errNotFile:"Object is not a file.",errRead:'Unable to read "$1".',errWrite:'Unable to write into "$1".',errPerm:"Permission denied.",errLocked:'"$1" is locked and can not be renamed, moved or removed.',errExists:'File named "$1" already exists.',errInvName:"Invalid file name.",errFolderNotFound:"Folder not found.",errFileNotFound:"File not found.",errTrgFolderNotFound:'Target folder "$1" not found.',errPopup:"Browser prevented opening popup window. To open file enable it in browser options.",
errMkdir:'Unable to create folder "$1".',errMkfile:'Unable to create file "$1".',errRename:'Unable to rename "$1".',errCopyFrom:'Copying files from volume "$1" not allowed.',errCopyTo:'Copying files to volume "$1" not allowed.',errUpload:"Upload error.",errUploadFile:'Unable to upload "$1".',errUploadNoFiles:"No files found for upload.",errUploadTotalSize:"Data exceeds the maximum allowed size.",errUploadFileSize:"File exceeds maximum allowed size.",errUploadMime:"File type not allowed.",errUploadTransfer:'"$1" transfer error.',
errNotReplace:'Object "$1" already exists at this location and can not be replaced by object with another type.',errReplace:'Unable to replace "$1".',errSave:'Unable to save "$1".',errCopy:'Unable to copy "$1".',errMove:'Unable to move "$1".',errCopyInItself:'Unable to copy "$1" into itself.',errRm:'Unable to remove "$1".',errRmSrc:"Unable remove source file(s).",errExtract:'Unable to extract files from "$1".',errArchive:"Unable to create archive.",errArcType:"Unsupported archive type.",errNoArchive:"File is not archive or has unsupported archive type.",
errCmdNoSupport:"Backend does not support this command.",errReplByChild:"The folder \u201c$1\u201d can\u2019t be replaced by an item it contains.",errArcSymlinks:"For security reason denied to unpack archives contains symlinks or files with not allowed names.",errArcMaxSize:"Archive files exceeds maximum allowed size.",errResize:'Unable to resize "$1".',errUsupportType:"Unsupported file type.",errNotUTF8Content:'File "$1" is not in UTF-8 and cannot be edited.',errNetMount:'Unable to mount "$1".',
errNetMountNoDriver:"Unsupported protocol.",errNetMountFailed:"Mount failed.",errNetMountHostReq:"Host required.",errNetUnMount:"Unable to unmount",cmdarchive:"Create archive",cmdback:"Back",cmdcopy:"Copy",cmdcut:"Cut",cmddownload:"Download",cmdduplicate:"Duplicate",cmdedit:"Edit file",cmdextract:"Extract files from archive",cmdforward:"Forward",cmdgetfile:"Select files",cmdhelp:"About this software",cmdhome:"Home",cmdinfo:"Get info",cmdmkdir:"New folder",cmdmkfile:"New text file",cmdopen:"Open",
cmdpaste:"Paste",cmdquicklook:"Preview",cmdreload:"Reload",cmdrename:"Rename",cmdrm:"Delete",cmdsearch:"Find files",cmdup:"Go to parent directory",cmdupload:"Upload files",cmdview:"View",cmdresize:"Resize & Rotate",cmdsort:"Sort",cmdnetmount:"Mount network volume",cmdnetunmount:"Unmount",cmdpixlr:"Edit on Pixlr",btnClose:"Close",btnSave:"Save",btnRm:"Remove",btnApply:"Apply",btnCancel:"Cancel",btnNo:"No",btnYes:"Yes",btnMount:"Mount",btnApprove:"Goto $1 & approve",btnUnmount:"Unmount",ntfopen:"Open folder",
ntffile:"Open file",ntfreload:"Reload folder content",ntfmkdir:"Creating directory",ntfmkfile:"Creating files",ntfrm:"Delete files",ntfcopy:"Copy files",ntfmove:"Move files",ntfprepare:"Prepare to copy files",ntfrename:"Rename files",ntfupload:"Uploading files",ntfdownload:"Downloading files",ntfsave:"Save files",ntfarchive:"Creating archive",ntfextract:"Extracting files from archive",ntfsearch:"Searching files",ntfresize:"Resizing images",ntfsmth:"Doing something >_<",ntfloadimg:"Loading image",
ntfnetmount:"Mounting network volume",ntfnetunmount:"Unmounting network volume",dateUnknown:"unknown",Today:"Today",Yesterday:"Yesterday",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",May:"May",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec",sortname:"by name",sortkind:"by kind",sortsize:"by size",sortdate:"by date",sortFoldersFirst:"Folders first",confirmReq:"Confirmation required",confirmRm:"Are you sure you want to remove files?<br/>This cannot be undone!",confirmRepl:"Replace old file with new one?",
apllyAll:"Apply to all",name:"Name",size:"Size",perms:"Permissions",modify:"Modified",kind:"Kind",read:"read",write:"write",noaccess:"no access",and:"and",unknown:"unknown",selectall:"Select all files",selectfiles:"Select file(s)",selectffile:"Select first file",selectlfile:"Select last file",viewlist:"List view",viewicons:"Icons view",places:"Places",calc:"Calculate",path:"Path",aliasfor:"Alias for",locked:"Locked",dim:"Dimensions",files:"Files",folders:"Folders",items:"Items",yes:"yes",no:"no",
link:"Link",searcresult:"Search results",selected:"selected items",about:"About",shortcuts:"Shortcuts",help:"Help",webfm:"Web file manager",ver:"Version",protocolver:"protocol version",homepage:"Project home",docs:"Documentation",github:"Fork us on Github",twitter:"Follow us on twitter",facebook:"Join us on facebook",team:"Team",chiefdev:"chief developer",developer:"developer",contributor:"contributor",maintainer:"maintainer",translator:"translator",icons:"Icons",dontforget:"and don't forget to take your towel",
shortcutsof:"Shortcuts disabled",dropFiles:"Drop files here",dropFilesBrowser:"Drop or paste files from browser",or:"or",selectForUpload:"Select files to upload",moveFiles:"Move files",copyFiles:"Copy files",rmFromPlaces:"Remove from places",aspectRatio:"Aspect ratio",scale:"Scale",width:"Width",height:"Height",resize:"Resize",crop:"Crop",rotate:"Rotate","rotate-cw":"Rotate 90 degrees CW","rotate-ccw":"Rotate 90 degrees CCW",degree:"\u00b0",netMountDialogTitle:"Mount network volume",protocol:"Protocol",
host:"Host",port:"Port",user:"User",pass:"Password",confirmUnmount:"Are you unmount $1?",kindUnknown:"Unknown",kindFolder:"Folder",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",
kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",
kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",
kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}});
$.fn.elfinderbutton=function(a){return this.each(function(){var c=a.fm,b=c.res("class","disabled"),d=c.res("class","active"),e=c.res("class","hover"),g,f=$(this).addClass("ui-state-default elfinder-button").attr("title",a.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+a.name+'"/>').hover(function(a){!f.is("."+b)&&f["mouseleave"==a.type?"removeClass":"addClass"](e)}).click(function(c){f.is("."+b)||(g&&1<a.variants.length?(g.is(":hidden")&&a.fm.getUI().click(),c.stopPropagation(),
g.slideToggle(100)):a.exec())}),c=function(){g.hide()};$.isArray(a.variants)&&(f.addClass("elfinder-menubutton"),g=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(f).zIndex(12+f.zIndex()).delegate(".elfinder-button-menu-item","hover",function(){$(this).toggleClass(e)}).delegate(".elfinder-button-menu-item","click",function(b){b.preventDefault();b.stopPropagation();f.removeClass(e);a.exec(a.fm.selected(),$(this).data("value"))}),a.fm.bind("disable select",
c).getUI().click(c),a.change(function(){g.html("");$.each(a.variants,function(b,c){g.append($('<div class="elfinder-button-menu-item">'+c[1]+"</div>").data("value",c[0]).addClass(c[0]==a.value?"elfinder-button-menu-item-selected":""))})}));a.change(function(){a.disabled()?f.removeClass(d+" "+e).addClass(b):(f.removeClass(b),f[a.active()?"addClass":"removeClass"](d))}).change()})};
$.fn.elfindercontextmenu=function(a){return this.each(function(){var c=$(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+a.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item","mouseenter mouseleave",function(){$(this).toggleClass("ui-state-hover")}),b="ltr"==a.direction?"left":"right",d=$.extend({},a.options.contextmenu),e=function(a,b,c){return $('<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"/><span>{label}</span></div>'.replace("{icon}",
b?"elfinder-button-icon-"+b:"").replace("{label}",a)).click(function(a){a.stopPropagation();a.stopPropagation();c()})},g=function(){c.hide().empty()};a.one("load",function(){a.bind("contextmenu",function(f){var h=f.data;g();if(h.type&&h.targets){var j=h.targets,l=!1;$.each(d[h.type]||[],function(b,d){var f,h,k;if("|"==d&&l)c.append('<div class="elfinder-contextmenu-separator"/>'),l=!1;else if((f=a.command(d))&&-1!=f.getstate(j)){if(f.variants){if(!f.variants.length)return;h=e(f.title,f.name,function(){});
k=$('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(h.append('<span class="elfinder-contextmenu-arrow"/>'));h.addClass("elfinder-contextmenu-group").hover(function(){k.toggle()});$.each(f.variants,function(a,b){k.append($('<div class="elfinder-contextmenu-item"><span>'+b[1]+"</span></div>").click(function(a){a.stopPropagation();g();f.exec(j,b[0])}))})}else h=e(f.title,f.name,function(){g();f.exec(j)});c.append(h);l=!0}})}else h.raw&&$.each(h.raw,function(a,b){var d;b.label&&"function"==
typeof b.callback&&(d=e(b.label,b.icon,function(){g();b.callback()}),c.append(d))});if(c.children().length){f=h.x;var h=h.y,k=$(window),m=c.outerWidth(),p=c.outerHeight(),r=k.width(),n=k.height(),x=k.scrollTop(),k=k.scrollLeft();f={top:(h+p<n?h:0<h-p?h-p:h)+x,left:(f+m<r?f:f-m)+k,"z-index":100+a.getUI("workzone").zIndex()};c.css(f).show();f={"z-index":f["z-index"]+10};f[b]=parseInt(c.width());c.find(".elfinder-contextmenu-sub").css(f)}}).one("destroy",function(){c.remove()}).bind("disable select",
g).getUI().click(g)})})};
$.fn.elfindercwd=function(a,c){this.not(".elfinder-cwd").each(function(){var b="list"==a.viewType,d="select."+a.namespace,e="unselect."+a.namespace,g="disable."+a.namespace,f="enable."+a.namespace,h=a.res("class","cwdfile"),j="."+h,l=a.res("class","disabled"),k=a.res("class","draggable"),m=a.res("class","droppable"),p=a.res("class","hover"),r=a.res("class","adroppable"),n=h+"-tmp",x=0<a.options.loadTmbs?a.options.loadTmbs:5,s="",y=[],u={icon:'<div id="{hash}" class="'+h+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>',row:'<tr id="{hash}" class="'+
h+' {permsclass} {dirclass}" title="{tooltip}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'},D=a.res("tpl","perms"),E=a.res("tpl","symlink"),Q={permsclass:function(b){return a.perms2class(b)},perms:function(b){return a.formatPermissions(b)},dirclass:function(a){return"directory"==a.mime?"directory":""},mime:function(b){return a.mime2class(b.mime)},
size:function(b){return a.formatSize(b.size)},date:function(b){return a.formatDate(b)},kind:function(b){return a.mime2kind(b)},marker:function(a){return(a.alias||"symlink-broken"==a.mime?E:"")+(!a.read||!a.write?D:"")},tooltip:function(b){var c=a.formatDate(b)+(0<b.size?" ("+a.formatSize(b.size)+")":"");return b.tooltip?a.escape(b.tooltip).replace(/"/g,"&quot;").replace(/\r/g,"&#13;")+"&#13;"+c:c}},J=function(c){c.name=a.escape(c.name);return u[b?"row":"icon"].replace(/\{([a-z]+)\}/g,function(a,b){return Q[b]?
Q[b](c):c[b]?c[b]:""})},K=!1,F=[],C=function(a){q.find("#"+a).trigger(d)},G=function(){F=[];q.find("[id].ui-selected").trigger(e);v()},v=function(){a.trigger("select",{selected:F})},w=function(a){var b=a.position().top;a=a.outerHeight(!0);var c=A.scrollTop(),d=A.innerHeight();b+a>c+d?A.scrollTop(parseInt(b+a-d)):b<c&&A.scrollTop(b)},t=[],H=function(a){for(var b=t.length;b--;)if(t[b].hash==a)return b;return-1},L="scroll."+a.namespace,B=function(){var c=[],f=!1,e=[],g={},c=q.find("[id]:last"),h=!c.length,
j=b?q.children("table").children("tbody"):q,k;if(!t.length)return A.unbind(L);for(;(!c.length||c.position().top<=A.height()+A.scrollTop()+a.options.showThreshold)&&(k=t.splice(0,a.options.showFiles)).length;)c=$.map(k,function(a){return a.hash&&a.name?("directory"==a.mime&&(f=!0),a.tmb&&(1===a.tmb?e.push(a.hash):g[a.hash]=a.tmb),J(a)):null}),j.append(c.join("")),c=q.find("[id]:last"),h&&q.scrollTop(0);S(g);e.length&&M(e);f&&V();F.length&&j.find("[id]:not(.ui-selected):not(.elfinder-cwd-parent)").each(function(){-1!==
$.inArray(this.id,F)&&$(this).trigger(d)})},O=$.extend({},a.droppable,{over:function(b,c){var d=a.cwd().hash;$.each(c.helper.data("files"),function(b,c){if(a.file(c).phash==d)return q.removeClass(r),!1})}}),V=function(){setTimeout(function(){q.find(".directory:not(."+m+",.elfinder-na,.elfinder-ro)").droppable(a.droppable)},20)},S=function(b){var c=a.option("tmbUrl"),d=!0,f;$.each(b,function(a,b){var e=q.find("#"+a);if(e.length){var g=c+b;$("<img/>").load(function(){e.find(".elfinder-cwd-icon").css("background",
"url('"+g+"') center center no-repeat")}).attr("src",g)}else if(d=!1,-1!=(f=H(a)))t[f].tmb=b});return d},M=function(b){var c=[];a.oldAPI?a.request({data:{cmd:"tmb",current:a.cwd().hash},preventFail:!0}).done(function(a){S(a.images||[])&&a.tmb&&M()}):(c=c=b.splice(0,x),c.length&&a.request({data:{cmd:"tmb",targets:c},preventFail:!0}).done(function(a){S(a.images||[])&&M(b)}))},z=function(c){for(var d=b?q.find("tbody"):q,f=c.length,e=[],g={},h=!1,j,k,l,m;f--;)if(j=c[f],k=j.hash,!q.find("#"+k).length){var p;
a:{p=j;for(var n=q.find("[id]:first"),u=void 0;n.length;){u=a.file(n.attr("id"));if(!n.is(".elfinder-cwd-parent")&&u&&0>a.compare(p,u)){p=n;break a}n=n.next("[id]")}p=void 0}if((l=p)&&l.length)l.before(J(j));else{a:{p=j;n=t.length;u=void 0;for(u=0;u<n;u++)if(0>a.compare(p,t[u])){p=u;break a}p=n||-1}0<=(m=p)?t.splice(m,0,j):d.append(J(j))}q.find("#"+k).length&&("directory"==j.mime?h=!0:j.tmb&&(1===j.tmb?e.push(k):g[k]=j.tmb))}S(g);e.length&&M(e);h&&V()},T=function(b){for(var c=b.length,d,f,e;c--;)if(d=
b[c],(f=q.find("#"+d)).length)try{f.detach()}catch(g){a.debug("error",g)}else-1!=(e=H(d))&&t.splice(e,1)},P=a.i18n("name"),U=a.i18n("perms"),I=a.i18n("modify"),X=a.i18n("size"),N=a.i18n("kind"),R=function(d,f){var e=a.cwd().hash;G();try{q.children("table,"+j).remove()}catch(g){q.html("")}q.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(b?"list":"icons"));A[b?"addClass":"removeClass"]("elfinder-cwd-wrapper-list");b&&q.html('<table><thead><tr class="ui-state-default"><td >'+
P+"</td><td>"+U+"</td><td>"+I+"</td><td>"+X+"</td><td>"+N+"</td></tr></thead><tbody/></table>");t=$.map(d,function(a){return f||a.phash==e?a:null});t=a.sortFiles(t);A.bind(L,B).trigger(L);e=a.cwd().phash;if(c.oldSchool&&e&&!s){var h=$.extend(!0,{},a.file(e),{name:"..",mime:"directory"}),h=$(J(h)).addClass("elfinder-cwd-parent").bind("mousedown click mouseup dblclick mouseenter",function(a){a.preventDefault();a.stopPropagation()}).dblclick(function(){a.exec("open",this.id)});(b?q.find("tbody"):q).prepend(h)}},
q=$(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").delegate(j,"click."+a.namespace,function(a){var b=this.id?$(this):$(this).parents("[id]:first"),c=b.prevAll(".ui-selected:first"),f=b.nextAll(".ui-selected:first"),g=c.length,h=f.length;a.stopImmediatePropagation();a.shiftKey&&(g||h)?(a=g?b.prevUntil("#"+c.attr("id")):b.nextUntil("#"+f.attr("id")),a.add(b).trigger(d)):a.ctrlKey||a.metaKey?b.trigger(b.is(".ui-selected")?e:d):(G(),b.trigger(d));v()}).delegate(j,"dblclick."+
a.namespace,function(){a.dblclick({file:this.id})}).delegate(j,"mouseenter."+a.namespace,function(){var c=$(this),d=b?c:c.children();!c.is("."+n)&&!d.is("."+k+",."+l)&&d.draggable(a.draggable)}).delegate(j,d,function(){var a=$(this),b=a.attr("id");!K&&!a.is("."+l)&&(a.addClass("ui-selected").children().addClass(p),-1===$.inArray(b,F)&&F.push(b))}).delegate(j,e,function(){var a=$(this).attr("id");K||($(this).removeClass("ui-selected").children().removeClass(p),a=$.inArray(a,F),-1!==a&&F.splice(a,1))}).delegate(j,
g,function(){var a=$(this).removeClass("ui-selected").addClass(l),c=(b?a:a.children()).removeClass(p);a.is("."+m)&&a.droppable("disable");c.is("."+k)&&c.draggable("disable");!b&&c.removeClass(l)}).delegate(j,f,function(){var a=$(this).removeClass(l),c=b?a:a.children();a.is("."+m)&&a.droppable("enable");c.is("."+k)&&c.draggable("enable")}).delegate(j,"scrolltoview",function(){w($(this))}).delegate(j,"hover",function(b){a.trigger("hover",{hash:$(this).attr("id"),type:b.type})}).bind("contextmenu."+
a.namespace,function(b){var c=$(b.target).closest("."+h);c.length&&(b.stopPropagation(),b.preventDefault(),c.is("."+l)||(c.is(".ui-selected")||(G(),c.trigger(d),v()),a.trigger("contextmenu",{type:"files",targets:a.selected(),x:b.clientX,y:b.clientY})))}).selectable({filter:j,stop:v,selected:function(a,b){$(b.selected).trigger(d)},unselected:function(a,b){$(b.unselected).trigger(e)}}).droppable(O).bind("create."+a.namespace,function(a,c){var d=b?q.find("tbody"):q,f=d.find(".elfinder-cwd-parent");c=
$(J(c)).addClass(n);G();f.length?f.after(c):d.prepend(c);q.scrollTop(0)}).bind("unselectall",G).bind("selectfile",function(a,b){q.find("#"+b).trigger(d);v()}),A=$('<div class="elfinder-cwd-wrapper"/>').bind("contextmenu",function(b){b.preventDefault();a.trigger("contextmenu",{type:"cwd",targets:[a.cwd().hash],x:b.clientX,y:b.clientY})}),W=function(){var a=0;A.siblings(".elfinder-panel:visible").each(function(){a+=$(this).outerHeight(!0)});A.height(Y.height()-a)},Y=$(this).parent().resize(W).children(".elfinder-workzone").append(A.append(this));
a.dragUpload&&(A[0].addEventListener("dragenter",function(a){a.preventDefault();a.stopPropagation();A.addClass(r)},!1),A[0].addEventListener("dragleave",function(a){a.preventDefault();a.stopPropagation();a.target==q[0]&&A.removeClass(r)},!1),A[0].addEventListener("dragover",function(a){a.preventDefault();a.stopPropagation()},!1),A[0].addEventListener("drop",function(b){b.preventDefault();A.removeClass(r);var c=!1,d="";b.dataTransfer&&b.dataTransfer.files&&b.dataTransfer.files.length?(c=b.dataTransfer.files,
d="files"):b.dataTransfer.getData("text/html")?(c=[b.dataTransfer.getData("text/html")],d="html"):b.dataTransfer.getData("text")&&(c=[b.dataTransfer.getData("text")],d="text");c&&a.exec("upload",{files:c,type:d})},!1));a.bind("open",function(a){R(a.data.files)}).bind("search",function(a){y=a.data.files;R(y,!0)}).bind("searchend",function(){y=[];s&&(s="",R(a.files()))}).bind("searchstart",function(a){s=a.data.query}).bind("sortchange",function(){R(s?y:a.files(),!!s)}).bind("viewchange",function(){var c=
a.selected(),d="list"==a.storage("view");d!=b&&(b=d,R(a.files()),$.each(c,function(a,b){C(b)}),v());W()}).add(function(b){var c=a.cwd().hash;b=s?$.map(b.data.added||[],function(a){return-1===a.name.indexOf(s)?null:a}):$.map(b.data.added||[],function(a){return a.phash==c?a:null});z(b)}).change(function(b){var c=a.cwd().hash,d=a.selected();s?$.each(b.data.changed||[],function(a,b){T([b.hash]);-1!==b.name.indexOf(s)&&(z([b]),-1!==$.inArray(b.hash,d)&&C(b.hash))}):$.each($.map(b.data.changed||[],function(a){return a.phash==
c?a:null}),function(a,b){T([b.hash]);z([b]);-1!==$.inArray(b.hash,d)&&C(b.hash)});v()}).remove(function(a){T(a.data.removed||[]);v()}).bind("open add search searchend",function(){q.css("height","auto");q.outerHeight(!0)<A.height()&&q.height(A.height()-(q.outerHeight(!0)-q.height())-2)}).dragstart(function(a){var b=$(a.data.target);a=a.data.originalEvent;b.is(j)&&(b.is(".ui-selected")||(!a.ctrlKey&&(!a.metaKey&&!a.shiftKey)&&G(),b.trigger(d),v()),q.droppable("disable"));q.selectable("disable").removeClass(l);
K=!0}).dragstop(function(){q.selectable("enable").droppable("enable");K=!1}).bind("lockfiles unlockfiles",function(a){var b="lockfiles"==a.type?g:f;a=a.data.files||[];for(var c=a.length;c--;)q.find("#"+a[c]).trigger(b);v()}).bind("mkdir mkfile duplicate upload rename archive extract",function(b){var c=a.cwd().hash;G();$.each(b.data.added||[],function(a,b){b&&b.phash==c&&C(b.hash)});v()}).shortcut({pattern:"ctrl+a",description:"selectall",callback:function(){var b=a.cwd().hash;q.find("[id]:not(.ui-selected):not(.elfinder-cwd-parent)").trigger(d);
F=$.map(a.files(),function(a){return a.phash==b?a.hash:null});v()}}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(a){var c=a.keyCode;a=a.shiftKey;var f=function(a,b){return a[b+"All"]("[id]:not(."+l+"):not(.elfinder-cwd-parent):first")},g=$.ui.keyCode,h=c==g.LEFT||c==g.UP,j=q.find("[id].ui-selected"),k,m;if(j.length)if(k=j.filter(h?":first":":last"),m=f(k,h?"prev":"next"),m.length)if(b||c==g.LEFT||c==g.RIGHT)c=
m;else if(g=k.position().top,m=k.position().left,c=k,h){do c=c.prev("[id]");while(c.length&&!(c.position().top<g&&c.position().left<=m));c.is("."+l)&&(c=f(c,"next"))}else{do c=c.next("[id]");while(c.length&&!(c.position().top>g&&c.position().left>=m));c.is("."+l)&&(c=f(c,"prev"));c.length||(m=q.find("[id]:not(."+l+"):last"),m.position().top>g&&(c=m))}else c=k;else c=q.find("[id]:not(."+l+"):not(.elfinder-cwd-parent):"+(h?"last":"first"));c&&(c.length&&!c.is(".elfinder-cwd-parent"))&&(a?c=k.add(k[h?
"prevUntil":"nextUntil"]("#"+c.attr("id"))).add(c):j.trigger(e),c.trigger(d),w(c.filter(h?":first":":last")),v())}}).shortcut({pattern:"home",description:"selectffile",callback:function(){G();w(q.find("[id]:first").trigger(d));v()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(){G();w(q.find("[id]:last").trigger(d));v()}})});return this};
$.fn.elfinderdialog=function(a){var c;if("string"==typeof a&&(c=this.closest(".ui-dialog")).length)"open"==a?"none"==c.css("display")&&c.fadeIn(120,function(){c.trigger("open")}):"close"==a?"none"!=c.css("display")&&c.hide().trigger("close"):"destroy"==a?c.hide().remove():"toTop"==a&&c.trigger("totop");a=$.extend({},$.fn.elfinderdialog.defaults,a);this.filter(":not(.ui-dialog-content)").each(function(){var b=$(this).addClass("ui-dialog-content ui-widget-content"),c=b.parent(),e=parseInt(1E6*Math.random()),
g=c.children(".elfinder-overlay"),f=$('<div class="ui-dialog-buttonset"/>'),h=$('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(f),j=$('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  elfinder-dialog '+a.cssClass+'"/>').hide().append(b).appendTo(c).draggable({handle:".ui-dialog-titlebar",containment:"document"}).css({width:a.width,height:a.height}).mousedown(function(a){a.stopPropagation();$(document).mousedown();j.is(".elfinder-dialog-active")||
(c.find(".elfinder-dialog:visible").removeClass("elfinder-dialog-active"),j.addClass("elfinder-dialog-active").zIndex(l()+1))}).bind("open",function(){a.modal&&g.elfinderoverlay("show");j.trigger("totop");"function"==typeof a.open&&$.proxy(a.open,b[0])();j.is(".elfinder-dialog-notify")||c.find(".elfinder-dialog:visible").not(".elfinder-dialog-notify").each(function(){var a=$(this),b=parseInt(a.css("top")),c=parseInt(a.css("left")),d=parseInt(j.css("top")),f=parseInt(j.css("left"));a[0]!=j[0]&&(b==
d||c==f)&&j.css({top:b+10+"px",left:c+10+"px"})})}).bind("close",function(){var f=c.find(".elfinder-dialog:visible"),e=l();a.modal&&g.elfinderoverlay("hide");f.length?f.each(function(){var a=$(this);if(a.zIndex()>=e)return a.trigger("totop"),!1}):setTimeout(function(){c.mousedown().click()},10);"function"==typeof a.close?$.proxy(a.close,b[0])():a.destroyOnClose&&j.hide().remove()}).bind("totop",function(){$(this).mousedown().find(".ui-button:first").focus().end().find(":text:first").focus()}),l=function(){var a=
c.zIndex()+10;c.find(".elfinder-dialog:visible").each(function(){var b;this!=j[0]&&(b=$(this).zIndex(),b>a&&(a=b))});return a},k;a.position||(k=parseInt((c.height()-j.outerHeight())/2-42),a.position={top:(0<k?k:0)+"px",left:parseInt((c.width()-j.outerWidth())/2)+"px"});j.css(a.position);a.closeOnEscape&&$(document).bind("keyup."+e,function(a){a.keyCode==$.ui.keyCode.ESCAPE&&j.is(".elfinder-dialog-active")&&(b.elfinderdialog("close"),$(document).unbind("keyup."+e))});j.prepend($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+
a.title+"</div>").prepend($('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function(a){a.preventDefault();b.elfinderdialog("close")})));$.each(a.buttons,function(a,c){var d=$('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+a+"</span></button>").click($.proxy(c,b[0])).hover(function(a){$(this)["mouseenter"==a.type?"focus":"blur"]()}).focus(function(){$(this).addClass("ui-state-hover")}).blur(function(){$(this).removeClass("ui-state-hover")}).keydown(function(a){a.keyCode==
$.ui.keyCode.ENTER?$(this).click():a.keyCode==$.ui.keyCode.TAB&&(a=$(this).next(".ui-button"),a.length?a.focus():$(this).parent().children(".ui-button:first").focus())});f.append(d)});f.children().length&&j.append(h);a.resizable&&$.fn.resizable&&j.resizable({minWidth:a.minWidth,minHeight:a.minHeight,alsoResize:this});"function"==typeof a.create&&$.proxy(a.create,this)();a.autoOpen&&b.elfinderdialog("open")});return this};
$.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},position:null,width:320,height:"auto",minWidth:200,minHeight:110};
$.fn.elfindernavbar=function(a,c){this.not(".elfinder-navbar").each(function(){var b=$(this).addClass("ui-state-default elfinder-navbar"),d=b.parent().resize(function(){b.height(d.height()-e)}).children(".elfinder-workzone").append(b),e=b.outerHeight()-b.height(),g="ltr"==a.direction,f;$.fn.resizable&&(f=b.resizable({handles:g?"e":"w",minWidth:c.minWidth||150,maxWidth:c.maxWidth||500}).bind("resize scroll",function(){f.css({top:parseInt(b.scrollTop())+"px",left:parseInt(g?b.width()+b.scrollLeft()-
f.width()-2:b.scrollLeft()+2)})}).find(".ui-resizable-handle").zIndex(b.zIndex()+10),g||b.resize(function(){b.css("left",null).css("right",0)}),a.one("open",function(){setTimeout(function(){b.trigger("resize")},150)}))});return this};
$.fn.elfinderoverlay=function(a){this.filter(":not(.elfinder-overlay)").each(function(){a=$.extend({},a);$(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(a){a.preventDefault();a.stopPropagation()}).data({cnt:0,show:"function"==typeof a.show?a.show:function(){},hide:"function"==typeof a.hide?a.hide:function(){}})});if("show"==a){var c=this.eq(0),b=c.data("cnt")+1,d=c.data("show");c.data("cnt",b);c.is(":hidden")&&(c.zIndex(c.parent().zIndex()+1),c.show(),d())}"hide"==
a&&(c=this.eq(0),b=c.data("cnt")-1,d=c.data("hide"),c.data("cnt",b),0==b&&c.is(":visible")&&(c.hide(),d()));return this};$.fn.elfinderpanel=function(a){return this.each(function(){var c=$(this).addClass("elfinder-panel ui-state-default ui-corner-all"),b="margin-"+("ltr"==a.direction?"left":"right");a.one("load",function(){var d=a.getUI("navbar");c.css(b,parseInt(d.outerWidth(!0)));d.bind("resize",function(){c.is(":visible")&&c.css(b,parseInt(d.outerWidth(!0)))})})})};
$.fn.elfinderpath=function(a){return this.each(function(){var c=$(this).addClass("elfinder-path").html("&nbsp;").delegate("a","click",function(b){var c=$(this).attr("href").substr(1);b.preventDefault();c!=a.cwd().hash&&a.exec("open",c)}).prependTo(a.getUI("statusbar").show());a.bind("open searchend",function(){var b=[];$.each(a.parents(a.cwd().hash),function(c,e){b.push('<a href="#'+e+'">'+a.escape(a.file(e).name)+"</a>")});c.html(b.join(a.option("separator")))}).bind("search",function(){c.html(a.i18n("searcresult"))})})};
$.fn.elfinderplaces=function(a,c){return this.each(function(){var b=[],d=a.res("class","navdir"),e=a.res("class","navcollapse"),g=a.res("class","navexpand");a.res("class","hover");var f=a.res("class","treeroot"),h=a.res("tpl","navdir"),j=a.res("tpl","perms"),l=$(a.res("tpl","navspinner")),k=function(a){return a.substr(6)},m=function(){a.storage("places",b.join(","))},p=function(b){return $(h.replace(/\{id\}/,"place-"+b.hash).replace(/\{name\}/,a.escape(b.name)).replace(/\{cssclass\}/,a.perms2class(b)).replace(/\{permissions\}/,
!b.read||!b.write?j:"").replace(/\{symlink\}/,""))},r=function(c){var f=p(c);y.children().length&&$.each(y.children(),function(){var a=$(this);if(0>c.name.localeCompare(a.children("."+d).text()))return!f.insertBefore(a)});b.push(c.hash);!f.parent().length&&y.append(f);s.addClass(e);f.draggable({appendTo:"body",revert:!1,helper:function(){var b=$(this);b.children().removeClass("ui-state-hover");return $('<div class="elfinder-place-drag elfinder-'+a.direction+'"/>').append(b.clone()).data("hash",k(b.children(":first").attr("id")))},
start:function(){$(this).hide()},stop:function(a,b){var c=u.offset().top,d=u.offset().left,f=u.width(),e=u.height(),g=a.clientX,h=a.clientY;g>d&&g<d+f&&h>c&&h<h+e?$(this).show():(n(b.helper.data("hash")),m())}})},n=function(a){var c=$.inArray(a,b);-1!==c&&(b.splice(c,1),y.find("#place-"+a).parent().remove(),!y.children().length&&s.removeClass(e+" "+g))},x=p({hash:"root-"+a.namespace,name:a.i18n(c.name,"places"),read:!0,write:!0}),s=x.children("."+d).addClass(f).click(function(){s.is("."+e)&&(u.toggleClass(g),
y.slideToggle(),a.storage("placesState",u.is("."+g)?1:0))}),y=x.children("."+a.res("class","navsubtree")),u=$(this).addClass(a.res("class","tree")+" elfinder-places ui-corner-all").hide().append(x).appendTo(a.getUI("navbar")).delegate("."+d,"hover",function(){$(this).toggleClass("ui-state-hover")}).delegate("."+d,"click",function(){a.exec("open",$(this).attr("id").substr(6))}).delegate("."+d+":not(."+f+")","contextmenu",function(b){var c=$(this).attr("id").substr(6);b.preventDefault();a.trigger("contextmenu",
{raw:[{label:a.i18n("rmFromPlaces"),icon:"rm",callback:function(){n(c);m()}}],x:b.clientX,y:b.clientY})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:a.res("class","adroppable"),drop:function(c,d){var f=!0;$.each(d.helper.data("files"),function(c,d){var e=a.file(d);e&&"directory"==e.mime&&-1===$.inArray(e.hash,b)?r(e):f=!1});m();f&&d.helper.hide()}});a.one("load",function(){a.oldAPI||(u.show().parent().show(),b=$.map(a.storage("places").split(","),
function(a){return a||null}),b.length&&(s.prepend(l),a.request({data:{cmd:"info",targets:b},preventDefault:!0}).done(function(c){b=[];$.each(c.files,function(a,b){"directory"==b.mime&&r(b)});m();0<a.storage("placesState")&&s.click()}).always(function(){l.remove()})),a.remove(function(a){$.each(a.data.removed,function(a,b){n(b)});m()}).change(function(a){$.each(a.data.changed,function(a,c){-1!==$.inArray(c.hash,b)&&(n(c.hash),"directory"==c.mime&&r(c))});m()}).bind("sync",function(){b.length&&(s.prepend(l),
a.request({data:{cmd:"info",targets:b},preventDefault:!0}).done(function(a){$.each(a.files||[],function(a,c){-1===$.inArray(c.hash,b)&&n(c.hash)});m()}).always(function(){l.remove()}))}))})})};
$.fn.elfindersearchbutton=function(a){return this.each(function(){var c=!1,b=$(this).hide().addClass("ui-widget-content elfinder-button "+a.fm.res("class","searchbtn")+""),d=function(){var b=$.trim(g.val());b?a.exec(b).done(function(){c=!0;g.focus()}):a.fm.trigger("searchend")},e=function(){g.val("");c&&(c=!1,a.fm.trigger("searchend"))},g=$('<input type="text" size="42"/>').appendTo(b).keypress(function(a){a.stopPropagation()}).keydown(function(a){a.stopPropagation();13==a.keyCode&&d();27==a.keyCode&&
(a.preventDefault(),e())});$('<span class="ui-icon ui-icon-search" title="'+a.title+'"/>').appendTo(b).click(d);$('<span class="ui-icon ui-icon-close"/>').appendTo(b).click(e);setTimeout(function(){b.parent().detach();a.fm.getUI("toolbar").prepend(b.show());if(a.fm.UA.ltIE7){var c=b.children("ltr"==a.fm.direction?".ui-icon-close":".ui-icon-search");c.css({right:"",left:parseInt(b.width())-c.outerWidth(!0)})}},200);a.fm.error(function(){g.unbind("keydown")}).select(function(){g.blur()}).bind("searchend",
function(){g.val("")}).viewchange(e).shortcut({pattern:"ctrl+f f3",description:a.title,callback:function(){g.select().focus()}})})};
$.fn.elfindersortbutton=function(a){return this.each(function(){var c=a.fm,b=a.name,d=c.res("class","disabled"),e=c.res("class","hover"),g=$(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+b).attr("title",a.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+b+'"/>').hover(function(){!g.is("."+d)&&g.toggleClass(e)}).click(function(b){g.is("."+d)||(b.stopPropagation(),f.is(":hidden")&&a.fm.getUI().click(),f.slideToggle(100))}),f=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(g).zIndex(12+
g.zIndex()).delegate(".elfinder-button-menu-item","hover",function(){$(this).toggleClass(e)}).delegate(".elfinder-button-menu-item","click",function(a){a.preventDefault();a.stopPropagation();j()}),h=function(){f.children(":not(:last)").removeClass("elfinder-button-menu-item-selected elfinder-button-menu-item-selected-asc elfinder-button-menu-item-selected-desc").filter('[rel="'+c.sortType+'"]').addClass("elfinder-button-menu-item-selected "+("asc"==c.sortOrder?"elfinder-button-menu-item-selected-asc":
"elfinder-button-menu-item-selected-desc"));f.children(":last").toggleClass("elfinder-button-menu-item-selected",c.sortStickFolders)},j=function(){f.hide()};$.each(c.sortRules,function(a){f.append($('<div class="elfinder-button-menu-item" rel="'+a+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+c.i18n("sort"+a)+"</div>").data("type",a))});f.children().click(function(){var b=$(this).attr("rel");a.exec([],{type:b,order:b==c.sortType?"asc"==c.sortOrder?
"desc":"asc":c.sortOrder,stick:c.sortStickFolders})});$('<div class="elfinder-button-menu-item elfinder-button-menu-item-separated"><span class="ui-icon ui-icon-check"/>'+c.i18n("sortFoldersFirst")+"</div>").appendTo(f).click(function(){a.exec([],{type:c.sortType,order:c.sortOrder,stick:!c.sortStickFolders})});c.bind("disable select",j).getUI().click(j);c.bind("sortchange",h);1<f.children().length?a.change(function(){g.toggleClass(d,a.disabled());h()}).change():g.addClass(d)})};
$.fn.elfinderstat=function(a){return this.each(function(){var c=$(this).addClass("elfinder-stat-size"),b=$('<div class="elfinder-stat-selected"/>'),d=a.i18n("size").toLowerCase(),e=a.i18n("items").toLowerCase(),g=a.i18n("selected"),f=function(b,f){var g=0,k=0;$.each(b,function(a,b){if(!f||b.phash==f)g++,k+=parseInt(b.size)||0});c.html(e+": "+g+", "+d+": "+a.formatSize(k))};a.getUI("statusbar").prepend(c).append(b).show();a.bind("open reload add remove change searchend",function(){f(a.files(),a.cwd().hash)}).search(function(a){f(a.data.files)}).select(function(){var c=
0,f=0,e=a.selectedFiles();1==e.length?(c=e[0].size,b.html(a.escape(e[0].name)+(0<c?", "+a.formatSize(c):""))):($.each(e,function(a,b){f++;c+=parseInt(b.size)||0}),b.html(f?g+": "+f+", "+d+": "+a.formatSize(c):"&nbsp;"))})})};
$.fn.elfindertoolbar=function(a,c){this.not(".elfinder-toolbar").each(function(){var b=a._commands,d=$(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),e=c||[],g=e.length,f,h,j,l;for(d.prev().length&&d.parent().prepend(this);g--;)if(e[g]){j=$('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>');for(f=e[g].length;f--;)if(h=b[e[g][f]])l="elfinder"+h.options.ui,$.fn[l]&&j.prepend($("<div/>")[l](h));j.children().length&&d.prepend(j);j.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}d.children().length&&
d.show()});return this};
$.fn.elfindertree=function(a,c){var b=a.res("class","tree");this.not("."+b).each(function(){var d=a.res("class","treeroot"),e=c.openRootOnLoad,g=a.res("class","navsubtree"),f=a.res("class","treedir"),h=a.res("class","navcollapse"),j=a.res("class","navexpand"),l=a.res("class","navarrow"),k=a.res("class","active"),m=a.res("class","adroppable"),p=a.res("class","hover"),r=a.res("class","disabled"),n=a.res("class","draggable"),x=a.res("class","droppable"),s=function(a){var b=O.offset().left;return b<=
a&&a<=b+O.width()},y=a.droppable.drop,u=$.extend(!0,{},a.droppable,{over:function(a){var b=$(this),c=p+" "+m;s(a.clientX)?(b.addClass(c),b.is("."+h+":not(."+j+")")&&setTimeout(function(){b.is("."+m)&&b.children("."+l).click()},500)):b.removeClass(c)},out:function(){$(this).removeClass(p+" "+m)},drop:function(a,b){s(a.clientX)&&y.call(this,a,b)}}),D=$(a.res("tpl","navspinner")),E=a.res("tpl","navdir"),Q=a.res("tpl","perms"),J=a.res("tpl","symlink"),K={id:function(b){return a.navHash2Id(b.hash)},cssclass:function(b){return(b.phash?
"":d)+" "+f+" "+a.perms2class(b)+" "+(b.dirs&&!b.link?h:"")},permissions:function(a){return!a.read||!a.write?Q:""},symlink:function(a){return a.alias?J:""}},F=function(b){b.name=a.escape(b.i18||b.name);return E.replace(/(?:\{([a-z]+)\})/ig,function(a,c){return b[c]||(K[c]?K[c](b):"")})},C=function(a){return $.map(a||[],function(a){return"directory"==a.mime?a:null})},G=function(b){return b?B.find("#"+a.navHash2Id(b)).next("."+g):B},v=function(b,c){for(var d=b.children(":first"),f;d.length;){f=a.file(a.navId2Hash(d.children("[id]").attr("id")));
if((f=a.file(a.navId2Hash(d.children("[id]").attr("id"))))&&0>c.name.toLowerCase().localeCompare(f.name.toLowerCase()))return d;d=d.next()}return $("")},w=function(b){for(var c=b.length,d=[],f=b.length,e,g,h,j;f--;)if(e=b[f],!B.find("#"+a.navHash2Id(e.hash)).length)if((h=G(e.phash)).length)if(g=F(e),e.phash&&(j=v(h,e)).length)j.before(g);else h[e.phash?"append":"prepend"](g);else d.push(e);if(d.length&&d.length<c)return w(d);setTimeout(function(){H()},10)},t=function(){var b=a.cwd().hash,h=B.find("#"+
a.navHash2Id(b)),m;e&&(m=B.find("#"+a.navHash2Id(a.root())),m.is(".elfinder-subtree-loaded")&&m.addClass(j).next("."+g).show(),e=!1);h.is("."+k)||(B.find("."+f+"."+k).removeClass(k),h.addClass(k));if(c.syncTree){if(h.length)return h.parentsUntil("."+d).filter("."+g).show().prev("."+f).addClass(j);if(a.newAPI){if((h=a.file(b))&&h.phash&&B.find("#"+a.navHash2Id(h.phash)).length)return w([h]),t();a.request({data:{cmd:"parents",target:b},preventFail:!0}).done(function(c){c=C(c.tree);w(c);L(c,"elfinder-subtree-loaded");
b==a.cwd().hash&&t(!0)})}}},H=function(){B.find("."+f+":not(."+x+",.elfinder-ro,.elfinder-na)").droppable(u)},L=function(b,c){var d="elfinder-subtree-loaded"==c?"."+h+":not(.elfinder-subtree-loaded)":":not(."+h+")";$.each(b,function(b,f){B.find("#"+a.navHash2Id(f.phash)+d).filter(function(){return 0<$(this).next("."+g).children().length}).addClass(c)})},B=$(this).addClass(b).delegate("."+f,"hover",function(b){var c=$(this);b="mouseenter"==b.type;c.is("."+m+" ,."+r)||(b&&!c.is("."+d+",."+n+",.elfinder-na,.elfinder-wo")&&
c.draggable(a.draggable),c.toggleClass(p,b))}).delegate("."+f,"dropover dropout drop",function(a){$(this)["dropover"==a.type?"addClass":"removeClass"](m+" "+p)}).delegate("."+f,"click",function(){var b=$(this),c=a.navId2Hash(b.attr("id")),d=a.file(c);a.trigger("searchend");c!=a.cwd().hash&&!b.is("."+r)?a.exec("open",d.thash||c):b.is("."+h)&&b.children("."+l).click()}).delegate("."+f+"."+h+" ."+l,"click",function(b){var c=$(this),d=c.parent("."+f),e=d.next("."+g);b.stopPropagation();d.is(".elfinder-subtree-loaded")?
(d.toggleClass(j),e.slideToggle()):(D.insertBefore(c),d.removeClass(h),a.request({cmd:"tree",target:a.navId2Hash(d.attr("id"))}).done(function(a){w(C(a.tree));e.children().length&&(d.addClass(h+" "+j),e.slideDown());t()}).always(function(){D.remove();d.addClass("elfinder-subtree-loaded")}))}).delegate("."+f,"contextmenu",function(b){b.preventDefault();a.trigger("contextmenu",{type:"navbar",targets:[a.navId2Hash($(this).attr("id"))],x:b.clientX,y:b.clientY})}),O=a.getUI("navbar").append(B).show();
a.open(function(a){a=a.data;var b=C(a.files);a.init&&B.empty();b.length&&(w(b),L(b,"elfinder-subtree-loaded"));t()}).add(function(a){a=C(a.data.added);a.length&&(w(a),L(a,h))}).change(function(b){b=C(b.data.changed);for(var c=b.length,d,e,h,k,m,l;c--;)if(d=b[c],(e=B.find("#"+a.navHash2Id(d.hash))).length){if(d.phash){h=e.closest("."+g);k=G(d.phash);m=e.parent().next();l=v(k,d);if(!k.length)continue;if(k[0]!==h[0]||m.get(0)!==l.get(0))l.length?l.before(e):k.append(e)}k=e.is("."+j);m=e.is(".elfinder-subtree-loaded");
h=$(F(d));e.replaceWith(h.children("."+f));if(d.dirs&&(k||m)&&(e=B.find("#"+a.navHash2Id(d.hash)))&&e.next("."+g).children().length)k&&e.addClass(j),m&&e.addClass("elfinder-subtree-loaded")}t();H()}).remove(function(b){b=b.data.removed;for(var c=b.length,d,e;c--;)if((d=B.find("#"+a.navHash2Id(b[c]))).length)e=d.closest("."+g),d.parent().detach(),e.children().length||e.hide().prev("."+f).removeClass(h+" "+j+" elfinder-subtree-loaded")}).bind("search searchend",function(b){B.find("#"+a.navHash2Id(a.cwd().hash))["search"==
b.type?"removeClass":"addClass"](k)}).bind("lockfiles unlockfiles",function(b){var c="lockfiles"==b.type,d=c?"disable":"enable";b=$.map(b.data.files||[],function(b){var c=a.file(b);return c&&"directory"==c.mime?b:null});$.each(b,function(b,e){var f=B.find("#"+a.navHash2Id(e));f.length&&(f.is("."+n)&&f.draggable(d),f.is("."+x)&&f.droppable(k),f[c?"addClass":"removeClass"](r))})})});return this};
$.fn.elfinderuploadbutton=function(a){return this.each(function(){var c=$(this).elfinderbutton(a).unbind("click"),b=$("<form/>").appendTo(c),d=$('<input type="file" multiple="true"/>').change(function(){var c=$(this);c.val()&&(a.exec({input:c.remove()[0]}),d.clone(!0).appendTo(b))});b.append(d.clone(!0));a.change(function(){b[a.disabled()?"hide":"show"]()}).change()})};
$.fn.elfinderviewbutton=function(a){return this.each(function(){var c=$(this).elfinderbutton(a),b=c.children(".elfinder-button-icon");a.change(function(){var d="icons"==a.value;b.toggleClass("elfinder-button-icon-view-list",d);c.attr("title",a.fm.i18n(d?"viewlist":"viewicons"))})})};
$.fn.elfinderworkzone=function(){this.not(".elfinder-workzone").each(function(){var a=$(this).addClass("elfinder-workzone"),c=a.outerHeight(!0)-a.height(),b=a.parent();b.add(window).bind("resize",function(){var d=b.height();b.children(":visible:not(.elfinder-workzone)").each(function(){var a=$(this);"absolute"!=a.css("position")&&(d-=a.outerHeight(!0))});a.height(d-c)})});return this};
elFinder.prototype.commands.archive=function(){var a=this,c=a.fm,b=[];this.variants=[];this.disableOnSearch=!0;c.bind("open reload",function(){a.variants=[];$.each(b=c.option("archivers").create||[],function(b,e){a.variants.push([e,c.mime2kind(e)])});a.change()});this.getstate=function(){return!this._disabled&&b.length&&c.selected().length&&c.cwd().write?0:-1};this.exec=function(a,e){var g=this.files(a),f=g.length,h=e||b[0],j=c.cwd(),l=["errArchive","errPerm"],k=$.Deferred().fail(function(a){a&&c.error(a)});
if(!this.enabled()||!f||!(b.length&&-1!==$.inArray(h,b)))return k.reject();if(!j.write)return k.reject(l);for(j=0;j<f;j++)if(!g[j].read)return k.reject(l);return c.request({data:{cmd:"archive",targets:this.hashes(a),type:h},notify:{type:"archive",cnt:1},syncOnFail:!0})}};elFinder.prototype.commands.back=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+left backspace"}];this.getstate=function(){return this.fm.history.canBack()?0:-1};this.exec=function(){return this.fm.history.back()}};
elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}];this.getstate=function(a){a=this.files(a);var c=a.length;return c&&$.map(a,function(a){return a.phash&&a.read?a:null}).length==c?0:-1};this.exec=function(a){var c=this.fm,b=$.Deferred().fail(function(a){c.error(a)});$.each(this.files(a),function(a,c){if(!c.read||!c.phash)return!b.reject(["errCopy",c.name,"errPerm"])});return"rejected"==b.state()?b:b.resolve(c.clipboard(this.hashes(a)))}};
elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}];this.getstate=function(a){a=this.files(a);var c=a.length;return c&&$.map(a,function(a){return a.phash&&a.read&&!a.locked?a:null}).length==c?0:-1};this.exec=function(a){var c=this.fm,b=$.Deferred().fail(function(a){c.error(a)});$.each(this.files(a),function(a,c){if(!c.read||!c.phash)return!b.reject(["errCopy",c.name,"errPerm"]);if(c.locked)return!b.reject(["errLocked",c.name])});return"rejected"==b.state()?
b:b.resolve(c.clipboard(this.hashes(a),!0))}};
elFinder.prototype.commands.download=function(){var a=this,c=this.fm,b=function(b){return $.map(a.files(b),function(a){return"directory"==a.mime?null:a})};this.shortcuts=[{pattern:"shift+enter"}];this.getstate=function(){var a=this.fm.selected(),e=a.length;return!this._disabled&&e&&(!c.UA.IE||1==e)&&e==b(a).length?0:-1};this.exec=function(a){var c=this.fm,g=c.options.url,f=b(a),h=$.Deferred(),j="",l="",k;if(this.disabled())return h.reject();if(c.oldAPI)return c.error("errCmdNoSupport"),h.reject();
$.each(c.options.customData||{},function(a,b){l+="&"+a+"="+b});g+=-1===g.indexOf("?")?"?":"&";for(k=0;k<f.length;k++)j+='<iframe class="downloader" id="downloader-'+f[k].hash+'" style="display:none" src="'+g+"cmd=file&target="+f[k].hash+"&download=1"+l+'"/>';$(j).appendTo("body").ready(function(){setTimeout(function(){$(j).each(function(){$("#"+$(this).attr("id")).remove()})},c.UA.Firefox?2E4+1E4*k:1E3)});c.trigger("download",{files:f});return h.resolve(a)}};
elFinder.prototype.commands.duplicate=function(){var a=this.fm;this.getstate=function(c){c=this.files(c);var b=c.length;return!this._disabled&&b&&a.cwd().write&&$.map(c,function(a){return a.phash&&a.read?a:null}).length==b?0:-1};this.exec=function(a){var b=this.fm,d=this.files(a),e=d.length,g=$.Deferred().fail(function(a){a&&b.error(a)});if(!e||this._disabled)return g.reject();$.each(d,function(a,c){if(!c.read||!b.file(c.phash).write)return!g.reject(["errCopy",c.name,"errPerm"])});return"rejected"==
g.state()?g:b.request({data:{cmd:"duplicate",targets:this.hashes(a)},notify:{type:"copy",cnt:e}})}};
elFinder.prototype.commands.edit=function(){var a=this,c=this.fm,b=c.res("mimes","text")||[],d=function(c){return $.map(c,function(c){return(0===c.mime.indexOf("text/")||-1!==$.inArray(c.mime,b))&&c.mime.indexOf("text/rtf")&&(!a.onlyMimes.length||-1!==$.inArray(c.mime,a.onlyMimes))&&c.read&&c.write?c:null})},e=function(b){var d=b.hash,e=$.Deferred();c.url(d);var j="edit-"+c.namespace+"-"+b.hash,l=c.getUI().find("#"+j);if(l.length)return l.elfinderdialog("toTop"),e.resolve();if(!b.read||!b.write)return l=
["errOpen",b.name,"errPerm"],c.error(l),e.reject(l);c.request({data:{cmd:"get",target:d},notify:{type:"openfile",cnt:1},syncOnFail:!0}).done(function(k){k=k.content;var m=$.Deferred(),l=$('<textarea class="elfinder-file-edit" rows="20" id="'+j+'-ta">'+c.escape(k)+"</textarea>"),r=function(){l.editor&&l.editor.save(l[0],l.editor.instance);m.resolve(l.getContent());l.elfinderdialog("close")},n=function(){m.reject();l.elfinderdialog("close")};k={title:b.name,width:a.options.dialogWidth||450,buttons:{},
close:function(){l.editor&&l.editor.close(l[0],l.editor.instance);$(this).elfinderdialog("destroy")},open:function(){c.disable();l.focus();l[0].setSelectionRange&&l[0].setSelectionRange(0,0);l.editor&&l.editor.load(l[0])}};l.getContent=function(){return l.val()};$.each(a.options.editors||[],function(a,c){if(-1!==$.inArray(b.mime,c.mimes||[])&&"function"==typeof c.load&&"function"==typeof c.save)return l.editor={load:c.load,save:c.save,close:"function"==typeof c.close?c.close:function(){},instance:null},
!1});l.editor||l.keydown(function(a){var b=a.keyCode,c,d;a.stopPropagation();9==b&&(a.preventDefault(),this.setSelectionRange&&(c=this.value,d=this.selectionStart,this.value=c.substr(0,d)+"\t"+c.substr(this.selectionEnd),d+=1,this.setSelectionRange(d,d)));if(a.ctrlKey||a.metaKey){if(81==b||87==b)a.preventDefault(),n();83==b&&(a.preventDefault(),r())}});k.buttons[c.i18n("Save")]=r;k.buttons[c.i18n("Cancel")]=n;c.dialog(l,k).attr("id",j);m.promise().done(function(a){c.request({options:{type:"post"},
data:{cmd:"put",target:d,content:a},notify:{type:"save",cnt:1},syncOnFail:!0}).fail(function(a){e.reject(a)}).done(function(a){a.changed&&a.changed.length&&c.change(a);e.resolve(a)})})}).fail(function(a){e.reject(a)});return e.promise()};this.shortcuts=[{pattern:"ctrl+e"}];this.init=function(){this.onlyMimes=this.options.mimes||[]};this.getstate=function(a){a=this.files(a);var b=a.length;return!this._disabled&&b&&d(a).length==b?0:-1};this.exec=function(a){a=d(this.files(a));var b=[],c;if(this.disabled())return $.Deferred().reject();
for(;c=a.shift();)b.push(e(c));return b.length?$.when.apply(null,b):$.Deferred().reject()}};
elFinder.prototype.commands.extract=function(){var a=this,c=a.fm,b=[];this.disableOnSearch=!0;c.bind("open reload",function(){b=c.option("archivers").extract||[];a.change()});this.getstate=function(a){a=this.files(a);var c=a.length;return!this._disabled&&c&&this.fm.cwd().write&&$.map(a,function(a){return a.read&&-1!==$.inArray(a.mime,b)?a:null}).length==c?0:-1};this.exec=function(a){a=this.files(a);var e=$.Deferred(),g=a.length,f=g,h,j;if(!this.enabled()||!g||!b.length)return e.reject();for(h=0;h<
g;h++){j=a[h];if(!j.read||!c.file(j.phash).write)return a=["errExtract",j.name,"errPerm"],c.error(a),e.reject(a);if(-1===$.inArray(j.mime,b))return a=["errExtract",j.name,"errNoArchive"],c.error(a),e.reject(a);c.request({data:{cmd:"extract",target:j.hash},notify:{type:"extract",cnt:1},syncOnFail:!0}).fail(function(a){"pending"==e.state()&&e.reject(a)}).done(function(){f--;0==f&&e.resolve()})}return e}};
elFinder.prototype.commands.forward=function(){this.updateOnSelect=this.alwaysEnabled=!0;this.shortcuts=[{pattern:"ctrl+right"}];this.getstate=function(){return this.fm.history.canForward()?0:-1};this.exec=function(){return this.fm.history.forward()}};
elFinder.prototype.commands.getfile=function(){var a=this,c=this.fm;this.alwaysEnabled=!0;this.callback=c.options.getFileCallback;this._disabled="function"==typeof this.callback;this.getstate=function(b){b=this.files(b);var c=b.length,e;if(e=this.callback)if(e=c){var g=a.options;b=$.map(b,function(a){return"directory"!=a.mime||g.folders?a:null});e=(g.multiple||1==b.length?b:[]).length==c}return e?0:-1};this.exec=function(b){var c=this.fm,e=this.options,g=this.files(b);b=g.length;var f=c.option("url"),
h=c.option("tmbUrl"),j=$.Deferred().done(function(b){c.trigger("getfile",{files:b});a.callback(b,c);"close"==e.oncomplete?c.hide():"destroy"==e.oncomplete&&c.destroy()}),l=function(){return e.onlyURL?e.multiple?$.map(g,function(a){return a.url}):g[0].url:e.multiple?g:g[0]},k=[],m,p,r;if(-1==this.getstate())return j.reject();for(m=0;m<b;m++){p=g[m];if("directory"==p.mime&&!e.folders)return j.reject();p.baseUrl=f;p.url=c.url(p.hash);p.path=c.path(p.hash);p.tmb&&1!=p.tmb&&(p.tmb=h+p.tmb);!p.width&&!p.height&&
(p.dim?(r=p.dim.split("x"),p.width=r[0],p.height=r[1]):-1!==p.mime.indexOf("image")&&k.push(c.request({data:{cmd:"dim",target:p.hash},preventDefault:!0}).done($.proxy(function(a){a.dim&&(r=a.dim.split("x"),this.width=r[0],this.height=r[1]);this.dim=a.dim},g[m]))))}return k.length?($.when.apply(null,k).always(function(){j.resolve(l(g))}),j):j.resolve(l(g))}};
elFinder.prototype.commands.help=function(){var a=this.fm,c=this,b=/\{url\}/,d=/\{link\}/,e=/\{author\}/,g=/\{work\}/,f=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'],h;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.state=0;this.shortcuts=[{pattern:"f1",description:this.title}];setTimeout(function(){var j=c.options.view||["about","shortcuts","help"];$.each(j,function(b,
c){f.push('<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}</a></li>'.replace(/\{id\}/,c).replace(/\{title\}/,a.i18n(c)))});f.push("</ul>");-1!==$.inArray("about",j)&&(f.push('<div id="about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>'),f.push("<h3>elFinder</h3>"),f.push('<div class="ui-priority-primary">'+a.i18n("webfm")+"</div>"),f.push('<div class="ui-priority-secondary">'+a.i18n("ver")+": "+a.version+", "+a.i18n("protocolver")+
': <span id="apiver"></span></div>'),f.push('<div class="ui-priority-secondary">jQuery/jQuery UI: '+$().jquery+"/"+$.ui.version+"</div>"),f.push('<div class="elfinder-help-separator"/>'),f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,"http://elfinder.org/").replace(d,a.i18n("homepage"))),f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,"https://github.com/Studio-42/elFinder/wiki").replace(d,a.i18n("docs"))),f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,
"https://github.com/Studio-42/elFinder").replace(d,a.i18n("github"))),f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,"http://twitter.com/elrte_elfinder").replace(d,a.i18n("twitter"))),f.push('<div class="elfinder-help-separator"/>'),f.push('<div class="ui-priority-primary">'+a.i18n("team")+"</div>"),f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(e,'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;').replace(g,a.i18n("chiefdev"))),f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(e,
"Troex Nevelin &lt;troex@fury.scancode.ru&gt;").replace(g,a.i18n("maintainer"))),f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(e,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;").replace(g,a.i18n("contributor"))),f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(e,"Naoki Sawada &lt;hypweb@gmail.com&gt;").replace(g,a.i18n("contributor"))),a.i18[a.lang].translator&&f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(e,
a.i18[a.lang].translator).replace(g,a.i18n("translator")+" ("+a.i18[a.lang].language+")")),f.push('<div class="elfinder-help-separator"/>'),f.push('<div class="elfinder-help-license">'+a.i18n("icons")+': <a href="http://pixelmixer.ru/" target="_blank">Pixelmixer</a>, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a></div>'),f.push('<div class="elfinder-help-separator"/>'),f.push('<div class="elfinder-help-license">Licence: BSD Licence</div>'),f.push('<div class="elfinder-help-license">Copyright \u00a9 2009-2011, Studio 42</div>'),
f.push('<div class="elfinder-help-license">\u201e \u2026'+a.i18n("dontforget")+" \u201d</div>"),f.push("</div>"));if(-1!==$.inArray("shortcuts",j)){var l=a.shortcuts();f.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');l.length?(f.push('<div class="ui-widget-content elfinder-help-shortcuts">'),$.each(l,function(a,b){f.push('<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>'.replace(/\{pattern\}/,b[0]).replace(/\{descrip\}/,
b[1]))}),f.push("</div>")):f.push('<div class="elfinder-help-disabled">'+a.i18n("shortcutsof")+"</div>");f.push("</div>")}-1!==$.inArray("help",j)&&(f.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),f.push('<a href="http://elfinder.org/forum/" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>'),f.push("</div>"));f.push("</div>");h=$(f.join(""));a.one("load",function(){h.find("#apiver").text(a.api)});h.find(".ui-tabs-nav li").hover(function(){$(this).toggleClass("ui-state-hover")}).children().click(function(a){var b=
$(this);a.preventDefault();a.stopPropagation();b.is(".ui-tabs-selected")||(b.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active"),h.find(".ui-tabs-panel").hide().filter(b.attr("href")).show())}).filter(":first").click()},200);this.getstate=function(){return 0};this.exec=function(){this.dialog||(this.dialog=this.fm.dialog(h,{title:this.title,width:530,autoOpen:!1,destroyOnClose:!1}));this.dialog.elfinderdialog("open").find(".ui-tabs-nav li a:first").click()}};
elFinder.prototype.commands.home=function(){this.title="Home";this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}];this.getstate=function(){var a=this.fm.root(),c=this.fm.cwd().hash;return a&&c&&a!=c?0:-1};this.exec=function(){return this.fm.exec("open",this.fm.root())}};
elFinder.prototype.commands.info=function(){var a=this.fm,c={calc:a.i18n("calc"),size:a.i18n("size"),unknown:a.i18n("unknown"),path:a.i18n("path"),aliasfor:a.i18n("aliasfor"),modify:a.i18n("modify"),perms:a.i18n("perms"),locked:a.i18n("locked"),dim:a.i18n("dim"),kind:a.i18n("kind"),files:a.i18n("files"),folders:a.i18n("folders"),items:a.i18n("items"),yes:a.i18n("yes"),no:a.i18n("no"),link:a.i18n("link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',
itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="elfinder-info-spinner"/>'};this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+i"}];this.init=function(){$.each(c,function(b,d){c[b]=a.i18n(d)})};this.getstate=function(){return 0};this.exec=function(a){var d=this.fm,e=this.tpl,g=e.row,f=this.files(a),h=f.length;
a=[];var j=e.main,l={title:this.title,width:"auto",close:function(){$(this).elfinderdialog("destroy")}},k=[],m=function(a){r.find(".elfinder-info-spinner").parent().text(a)},p=d.namespace+"-info-"+$.map(f,function(a){return a.hash}).join("-"),r=d.getUI().find("#"+p),n,x,s,y;if(!h)return $.Deferred().reject();if(r.length)return r.elfinderdialog("toTop"),$.Deferred().resolve();1==h?(f=f[0],j=j.replace("{class}",d.mime2class(f.mime)),s=e.itemTitle.replace("{name}",d.escape(f.i18||f.name)).replace("{kind}",
d.mime2kind(f)),f.tmb&&(x=d.option("tmbUrl")+f.tmb),f.read?"directory"!=f.mime||f.alias?n=d.formatSize(f.size):(n=e.spinner.replace("{text}",c.calc),k.push(f.hash)):n=c.unknown,a.push(g.replace("{label}",c.size).replace("{value}",n)),f.alias&&a.push(g.replace("{label}",c.aliasfor).replace("{value}",f.alias)),a.push(g.replace("{label}",c.path).replace("{value}",d.escape(d.path(f.hash,!0)))),f.read&&a.push(g.replace("{label}",c.link).replace("{value}",'<a href="'+d.url(f.hash)+'" target="_blank">'+
f.name+"</a>")),f.dim?a.push(g.replace("{label}",c.dim).replace("{value}",f.dim)):-1!==f.mime.indexOf("image")&&(f.width&&f.height?a.push(g.replace("{label}",c.dim).replace("{value}",f.width+"x"+f.height)):(a.push(g.replace("{label}",c.dim).replace("{value}",e.spinner.replace("{text}",c.calc))),d.request({data:{cmd:"dim",target:f.hash},preventDefault:!0}).fail(function(){m(c.unknown)}).done(function(a){m(a.dim||c.unknown)}))),a.push(g.replace("{label}",c.modify).replace("{value}",d.formatDate(f))),
a.push(g.replace("{label}",c.perms).replace("{value}",d.formatPermissions(f))),a.push(g.replace("{label}",c.locked).replace("{value}",f.locked?c.yes:c.no))):(j=j.replace("{class}","elfinder-cwd-icon-group"),s=e.groupTitle.replace("{items}",c.items).replace("{num}",h),(y=$.map(f,function(a){return"directory"==a.mime?1:null}).length)?(a.push(g.replace("{label}",c.kind).replace("{value}",y==h?c.folders:c.folders+" "+y+", "+c.files+" "+(h-y))),a.push(g.replace("{label}",c.size).replace("{value}",e.spinner.replace("{text}",
c.calc))),k=$.map(f,function(a){return a.hash})):(n=0,$.each(f,function(a,b){var c=parseInt(b.size);n=0<=c&&0<=n?n+c:"unknown"}),a.push(g.replace("{label}",c.kind).replace("{value}",c.files)),a.push(g.replace("{label}",c.size).replace("{value}",d.formatSize(n)))));j=j.replace("{title}",s).replace("{content}",a.join(""));r=d.dialog(j,l);r.attr("id",p);x&&$("<img/>").load(function(){r.find(".elfinder-cwd-icon").css("background",'url("'+x+'") center center no-repeat')}).attr("src",x);k.length&&d.request({data:{cmd:"size",
targets:k},preventDefault:!0}).fail(function(){m(c.unknown)}).done(function(a){a=parseInt(a.size);m(0<=a?d.formatSize(a):c.unknown)})}};elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=!0;this.updateOnSelect=!1;this.mime="directory";this.prefix="untitled folder";this.exec=$.proxy(this.fm.res("mixin","make"),this);this.shortcuts=[{pattern:"ctrl+shift+n"}];this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}};
elFinder.prototype.commands.mkfile=function(){this.disableOnSearch=!0;this.updateOnSelect=!1;this.mime="text/plain";this.prefix="untitled file.txt";this.exec=$.proxy(this.fm.res("mixin","make"),this);this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}};
elFinder.prototype.commands.netmount=function(){var a=this;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.drivers=[];this.handlers={load:function(){this.drivers=this.fm.netDrivers}};this.getstate=function(){return this.drivers.length?0:-1};this.exec=function(){var c=a.fm,b=$.Deferred(),d=a.options;if(!a.dialog){var e,g=$("<select/>").change(function(){var a=this.value;f.find(".elfinder-netmount-tr").hide();f.find(".elfinder-netmount-tr-"+a).show();"function"==typeof d[a].select&&d[a].select(c)});
e={title:c.i18n("netMountDialogTitle"),resizable:!1,modal:!0,destroyOnClose:!0,close:function(){delete a.dialog;"pending"==b.state()&&b.reject()},buttons:{}};var f=$('<table class="elfinder-info-tb elfinder-netmount-tb"/>'),h=$("<div/>");f.append($("<tr/>").append($("<td>"+c.i18n("protocol")+"</td>")).append($("<td/>").append(g)));$.each(a.drivers,function(a,b){g.append('<option value="'+b+'">'+c.i18n(b)+"</option>");$.each(d[b].inputs,function(a,d){d.attr("name",a);"hidden"!=d.attr("type")?(d.addClass("ui-corner-all elfinder-netmount-inputs-"+
b),f.append($("<tr/>").addClass("elfinder-netmount-tr elfinder-netmount-tr-"+b).append($("<td>"+c.i18n(a)+"</td>")).append($("<td/>").append(d)))):(d.addClass("elfinder-netmount-inputs-"+b),h.append(d))})});f.append(h);f.find(".elfinder-netmount-tr").hide();g.change();e.buttons[c.i18n("btnMount")]=function(){var c=g.val(),d={cmd:"netmount",protocol:c};$.each(f.find("input.elfinder-netmount-inputs-"+c),function(a,b){var c;(c="function"==typeof b.val?$.trim(b.val()):$.trim(b.value))&&(d[b.name]=c)});
if(!d.host)return a.fm.trigger("error",{error:"errNetMountHostReq"});a.fm.request({data:d,notify:{type:"netmount",cnt:1}}).done(function(){b.resolve()}).fail(function(a){b.reject(a)});a.dialog.elfinderdialog("close")};e.buttons[c.i18n("btnCancel")]=function(){a.dialog.elfinderdialog("close")};e=c.dialog(f,e);a.dialog=e}return b.promise()}};
elFinder.prototype.commands.netunmount=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.drivers=[];this.handlers={load:function(){this.drivers=this.fm.netDrivers}};this.getstate=function(a){var c=this.fm;return a&&this.drivers.length&&!this._disabled&&c.file(a[0]).netkey?0:-1};this.exec=function(a){var c=this.fm,b=$.Deferred().fail(function(a){a&&c.error(a)}),d=c.file(a[0]);if(this._disabled)return b.reject();"pending"==b.state()&&c.confirm({title:this.title,text:c.i18n("confirmUnmount",
d.name),accept:{label:"btnUnmount",callback:function(){c.request({data:{cmd:"netmount",protocol:"netunmount",host:d.netkey,user:"dum",pass:"dum"},notify:{type:"netunmount",cnt:1},preventFail:!0}).fail(function(a){b.reject(a)}).done(function(){b.promise()})}},cancel:{label:"btnCancel",callback:function(){b.reject()}}});return b}};
elFinder.prototype.commands.open=function(){this.alwaysEnabled=!0;this._handlers={dblclick:function(a){a.preventDefault();this.exec()},"select enable disable reload":function(a){this.update("disable"==a.type?-1:void 0)}};this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=this.fm.OS&&" enter")}];this.getstate=function(a){a=this.files(a);var c=a.length;return 1==c?0:c?$.map(a,function(a){return"directory"==a.mime?null:a}).length==c?0:-1:-1};this.exec=function(a){var c=this.fm,b=$.Deferred().fail(function(a){a&&
c.error(a)}),d=this.files(a),e=d.length,g,f,h;if(!e)return b.reject();if(1==e&&(g=d[0])&&"directory"==g.mime)return g&&!g.read?b.reject(["errOpen",g.name,"errPerm"]):c.request({data:{cmd:"open",target:g.thash||g.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0});d=$.map(d,function(a){return"directory"!=a.mime?a:null});if(e!=d.length)return b.reject();for(e=d.length;e--;){g=d[e];if(!g.read)return b.reject(["errOpen",g.name,"errPerm"]);if(!(f=c.url(g.hash)))f=c.options.url,f=f+(-1===f.indexOf("?")?
"?":"&")+(c.oldAPI?"cmd=open&current="+g.phash:"cmd=file")+"&target="+g.hash;h="";g.dim&&(g=g.dim.split("x"),h="width="+(parseInt(g[0])+20)+",height="+(parseInt(g[1])+20));if(!window.open(f,"_blank",h+",top=50,left=50,scrollbars=yes,resizable=yes"))return b.reject("errPopup")}return b.resolve(a)}};
elFinder.prototype.commands.paste=function(){this.updateOnSelect=!1;this.handlers={changeclipboard:function(){this.update()}};this.shortcuts=[{pattern:"ctrl+v shift+insert"}];this.getstate=function(a){if(this._disabled)return-1;if(a){if($.isArray(a)){if(1!=a.length)return-1;a=this.fm.file(a[0])}}else a=this.fm.cwd();return this.fm.clipboard().length&&"directory"==a.mime&&a.write?0:-1};this.exec=function(a){var c=this,b=c.fm;a=a?this.files(a)[0]:b.cwd();var d=b.clipboard(),e=d.length,g=e?d[0].cut:
!1,f=g?"errMove":"errCopy",h=[],j=[],l=$.Deferred().fail(function(a){a&&b.error(a)}),k,m;if(!e||!a||"directory"!=a.mime)return l.reject();if(!a.write)return l.reject([f,d[0].name,"errPerm"]);k=b.parents(a.hash);$.each(d,function(c,e){if(!e.read)return!l.reject([f,d[0].name,"errPerm"]);if(g&&e.locked)return!l.reject(["errLocked",e.name]);if(-1!==$.inArray(e.hash,k))return!l.reject(["errCopyInItself",e.name]);m=b.parents(e.hash);if(-1!==$.inArray(a.hash,m)&&$.map(m,function(c){c=b.file(c);return c.phash==
a.hash&&c.name==e.name?c:null}).length)return!l.reject(["errReplByChild",e.name]);e.phash==a.hash?j.push(e.hash):h.push({hash:e.hash,phash:e.phash,name:e.name})});return"rejected"==l.state()?l:$.when(j.length&&b._commands.duplicate?b.exec("duplicate",j):$.Deferred().resolve(),function(d){var e=$.Deferred(),f=[],h=function(a){var c=d[f[a]],j=a==f.length-1;c&&b.confirm({title:b.i18n(g?"moveFiles":"copyFiles"),text:b.i18n(["errExists",c.name,"confirmRepl"]),all:!j,accept:{label:"btnYes",callback:function(b){!j&&
!b?h(++a):k(d)}},reject:{label:"btnNo",callback:function(b){var c;if(b)for(c=f.length;a<c--;)d[f[c]].remove=!0;else d[f[a]].remove=!0;!j&&!b?h(++a):k(d)}},cancel:{label:"btnCancel",callback:function(){e.resolve()}}})},j=function(a){for(var b=[],c=d.length;c--;)-1!==$.inArray(d[c].name,a)&&b.unshift(c);f=b;f.length?h(0):k(d)},k=function(c){c=$.map(c,function(a){return!a.remove?a:null});var d=c.length,f;if(!d)return e.resolve();f=c[0].phash;c=$.map(c,function(a){return a.hash});b.request({data:{cmd:"paste",
dst:a.hash,targets:c,cut:g?1:0,src:f},notify:{type:g?"move":"copy",cnt:d}}).always(function(){e.resolve();b.unlockfiles({files:c})})};if(c._disabled||!d.length)return e.resolve();b.oldAPI?k(d):b.option("copyOverwrite")?a.hash==b.cwd().hash?j($.map(b.files(),function(b){return b.phash==a.hash?b.name:null})):b.request({data:{cmd:"ls",target:a.hash},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(a){j(a.list||[])}):k(d);return e}(h)).always(function(){g&&b.clipboard([])})}};
elFinder.prototype.commands.pixlr=function(){this.updateOnSelect=!1;this.getstate=function(a){var c=this.fm;a=c.selectedFiles();return!this._disabled&&1==a.length&&a[0].read&&-1!==a[0].mime.indexOf("image/")&&c.file(a[0].phash)&&c.file(a[0].phash).write?0:-1};this.exec=function(a){var c=this.fm,b=$.Deferred().fail(function(a){a&&c.error(a)}),d=this.files(a);a=d.length;var e=function(a){var e,g,l;e=d[0];g=c.uploadURL;g=g+(-1===g.indexOf("?")?"?":"&")+"cmd=pixlr&target="+e.phash+"&node="+encodeURIComponent(c.id);
l=c.uploadURL;l=l+(-1===l.indexOf("?")?"?":"&")+"cmd=pixlr";a="http://pixlr.com/"+a+"/?image="+encodeURIComponent(c.url(e.hash))+"&target="+encodeURIComponent(g)+"&title="+encodeURIComponent("pixlr_"+e.name)+"&exit="+encodeURIComponent(l);if(!window.open(a))return b.reject("errPopup")},g=$("<div/>");if(!a)return b.reject();g.css("text-align","center").append($("<button/>").css("margin","30px").append("Pixlr Editor").button().click(function(){e("editor");$(this).elfinderdialog("destroy");return!1})).append($("<button/>").css("margin",
"30px").append("Pixlr Express").button().click(function(){e("express");$(this).elfinderdialog("destroy");return!1}));dialog=c.dialog(g,{title:"Pixlr Editor or Pixlr Express ?",width:"auto",close:function(){$(this).elfinderdialog("destroy")}});return b.resolve()}};
elFinder.prototype.commands.quicklook=function(){var a=this,c=a.fm,b=0,d=function(a){$(document).trigger($.Event("keydown",{keyCode:a,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},e=function(a){return{opacity:0,width:20,height:"list"==c.view?1:20,top:a.offset().top+"px",left:a.offset().left+"px"}},g=function(){var a=$(window);return{opacity:1,width:h,height:j,top:parseInt((a.height()-j)/2+a.scrollTop()),left:parseInt((a.width()-h)/2+a.scrollLeft())}},f=function(a){var b=document.createElement(a.substr(0,
a.indexOf("/"))),c=!1;try{c=b.canPlayType&&b.canPlayType(a)}catch(d){}return c&&""!==c&&"no"!=c},h,j,l,k,m=$('<div class="elfinder-quicklook-title"/>'),p=$("<div/>"),r=$('<div class="elfinder-quicklook-info"/>'),n=$('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-fullscreen"/>').mousedown(function(b){var d=a.window,e=d.is(".elfinder-quicklook-fullscreen"),f="scroll."+c.namespace,g=$(window);b.stopPropagation();e?(d.css(d.data("position")).unbind("mousemove"),g.unbind(f).trigger(a.resize).unbind(a.resize),
x.unbind("mouseenter").unbind("mousemove")):(d.data("position",{left:d.css("left"),top:d.css("top"),width:d.width(),height:d.height()}).css({width:"100%",height:"100%"}),$(window).bind(f,function(){d.css({left:parseInt($(window).scrollLeft())+"px",top:parseInt($(window).scrollTop())+"px"})}).bind(a.resize,function(){a.preview.trigger("changesize")}).trigger(f).trigger(a.resize),d.bind("mousemove",function(){x.stop(!0,!0).show().delay(3E3).fadeOut("slow")}).mousemove(),x.mouseenter(function(){x.stop(!0,
!0).show()}).mousemove(function(a){a.stopPropagation()}));x.attr("style","").draggable(e?"destroy":{});d.toggleClass("elfinder-quicklook-fullscreen");$(this).toggleClass("elfinder-quicklook-navbar-icon-fullscreen-off");$.fn.resizable&&l.add(d).resizable(e?"enable":"disable").removeClass("ui-state-disabled")}),x=$('<div class="elfinder-quicklook-navbar"/>').append($('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-prev"/>').mousedown(function(){d(37)})).append(n).append($('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-next"/>').mousedown(function(){d(39)})).append('<div class="elfinder-quicklook-navbar-separator"/>').append($('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-close"/>').mousedown(function(){a.window.trigger("close")}));
this.resize="resize."+c.namespace;this.info=$('<div class="elfinder-quicklook-info-wrapper"/>').append(p).append(r);this.preview=$('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(){a.info.attr("style","").hide();p.removeAttr("class").attr("style","");r.html("")}).bind("update",function(b){var c=a.fm,d=b.file,e;d?(!d.read&&b.stopImmediatePropagation(),a.window.data("hash",d.hash),a.preview.unbind("changesize").trigger("change").children().remove(),m.html(c.escape(d.name)),
r.html('<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,d.name)+'<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,c.mime2kind(d))+("directory"==d.mime?"":'<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,c.formatSize(d.size)))+'<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,c.i18n("modify")+": "+c.formatDate(d))),p.addClass("elfinder-cwd-icon ui-corner-all "+c.mime2class(d.mime)),d.tmb&&
$("<img/>").hide().appendTo(a.preview).load(function(){p.css("background",'url("'+e+'") center center no-repeat');$(this).remove()}).attr("src",e=c.tmb(d.hash)),a.info.delay(100).fadeIn(10)):b.stopImmediatePropagation()});this.window=$('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(a){a.stopPropagation()}).append($('<div class="elfinder-quicklook-titlebar"/>').append(m).append($('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(b){b.stopPropagation();
a.window.trigger("close")}))).append(this.preview.add(x)).append(a.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(){var c=a.window,d=a.value,f;if(a.closed()&&d&&(f=k.find("#"+d.hash)).length)x.attr("style",""),b=1,f.trigger("scrolltoview"),c.css(e(f)).show().animate(g(),550,function(){b=2;a.update(1,a.value)})}).bind("close",function(){var c=a.window,d=a.preview.trigger("change"),f=k.find("#"+c.data("hash")),g=function(){b=0;c.hide();d.children().remove();
a.update(0,a.value)};a.opened()&&(b=1,c.is(".elfinder-quicklook-fullscreen")&&n.mousedown(),f.length?c.animate(e(f),500,g):g())});this.alwaysEnabled=!0;this.value=null;this.handlers={select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){a.window.is(":visible")&&a.window.data("hash","").trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}};this.shortcuts=[{pattern:"space"}];this.support={audio:{ogg:f('audio/ogg; codecs="vorbis"'),
mp3:f("audio/mpeg;"),wav:f('audio/wav; codecs="1"'),m4a:f("audio/x-m4a;")||f("audio/aac;")},video:{ogg:f('video/ogg; codecs="theora"'),webm:f('video/webm; codecs="vp8, vorbis"'),mp4:f('video/mp4; codecs="avc1.42E01E"')||f('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}};this.closed=function(){return 0==b};this.opened=function(){return 2==b};this.init=function(){var b=this.options,d=this.window,e=this.preview;h=0<b.width?parseInt(b.width):450;j=0<b.height?parseInt(b.height):300;c.one("load",function(){l=
c.getUI();k=c.getUI("cwd");d.appendTo("body").zIndex(100+l.zIndex());$(document).keydown(function(b){27==b.keyCode&&a.opened()&&d.trigger("close")});$.fn.resizable&&d.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){e.trigger("changesize")}});a.change(function(){a.opened()&&(a.value?e.trigger($.Event("update",{file:a.value})):d.trigger("close"))});$.each(c.commands.quicklook.plugins||[],function(b,c){"function"==typeof c&&new c(a)});e.bind("update",function(){a.info.show()})})};
this.getstate=function(){return 1==this.fm.selected().length?2==b?1:0:-1};this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open")};this.hideinfo=function(){this.info.stop(!0).hide()}};
elFinder.prototype.commands.quicklook.plugins=[function(a){var c=["image/jpeg","image/png","image/gif"],b=a.preview;$.each(navigator.mimeTypes,function(a,b){var g=b.type;0===g.indexOf("image/")&&$.inArray(g,c)&&c.push(g)});b.bind("update",function(d){var e=d.file,g;-1!==$.inArray(e.mime,c)&&(d.stopImmediatePropagation(),g=$("<img/>").hide().appendTo(b).load(function(){setTimeout(function(){var c=(g.width()/g.height()).toFixed(2);b.bind("changesize",function(){var a=parseInt(b.width()),d=parseInt(b.height()),
e;c<(a/d).toFixed(2)?(e=d,a=Math.floor(e*c)):e=Math.floor(a/c);g.width(a).height(e).css("margin-top",e<d?Math.floor((d-e)/2):0)}).trigger("changesize");a.hideinfo();g.fadeIn(100)},1)}).attr("src",a.fm.url(e.hash)))})},function(a){var c=["text/html","application/xhtml+xml"],b=a.preview,d=a.fm;b.bind("update",function(e){var g=e.file,f;-1!==$.inArray(g.mime,c)&&(e.stopImmediatePropagation(),b.one("change",function(){"pending"==f.state()&&f.reject()}),f=d.request({data:{cmd:"get",target:g.hash,current:g.phash},
preventDefault:!0}).done(function(c){a.hideinfo();doc=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(b)[0].contentWindow.document;doc.open();doc.write(c.content);doc.close()}))})},function(a){var c=a.fm,b=c.res("mimes","text"),d=a.preview;d.bind("update",function(e){var g=e.file,f=g.mime,h;if(0===f.indexOf("text/")||-1!==$.inArray(f,b))e.stopImmediatePropagation(),d.one("change",function(){"pending"==h.state()&&h.reject()}),h=c.request({data:{cmd:"get",target:g.hash},preventDefault:!0}).done(function(b){a.hideinfo();
$('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+c.escape(b.content)+"</pre></div>").appendTo(d)})})},function(a){var c=a.fm,b=a.preview,d=!1;c.UA.Safari&&"mac"==c.OS||c.UA.IE?d=!0:$.each(navigator.plugins,function(a,b){$.each(b,function(a,b){if("application/pdf"==b.type)return!(d=!0)})});d&&b.bind("update",function(d){var g=d.file,f;"application/pdf"==g.mime&&(d.stopImmediatePropagation(),b.one("change",function(){f.unbind("load").remove()}),
f=$('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(b).load(function(){a.hideinfo();f.show()}).attr("src",c.url(g.hash)))})},function(a){var c=a.fm,b=a.preview,d=!1;$.each(navigator.plugins,function(a,b){$.each(b,function(a,b){if("application/x-shockwave-flash"==b.type)return!(d=!0)})});d&&b.bind("update",function(d){var g=d.file;"application/x-shockwave-flash"==g.mime&&(d.stopImmediatePropagation(),a.hideinfo(),b.append($('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+
c.url(g.hash)+'" quality="high" type="application/x-shockwave-flash" />')))})},function(a){var c=a.preview,b=!!a.options.autoplay,d={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},e;c.bind("update",function(g){var f=g.file;a.support.audio[d[f.mime]]&&(g.stopImmediatePropagation(),e=$('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+
a.fm.url(f.hash)+'" /></audio>').appendTo(c),b&&e[0].play())}).bind("change",function(){e&&e.parent().length&&(e[0].pause(),e.remove(),e=null)})},function(a){var c=a.preview,b=!!a.options.autoplay,d={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},e;c.bind("update",function(g){var f=g.file;a.support.video[d[f.mime]]&&(g.stopImmediatePropagation(),a.hideinfo(),e=$('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+
a.fm.url(f.hash)+'" /></video>').appendTo(c),b&&e[0].play())}).bind("change",function(){e&&e.parent().length&&(e[0].pause(),e.remove(),e=null)})},function(a){var c=a.preview,b=[],d;$.each(navigator.plugins,function(a,c){$.each(c,function(a,c){(0===c.type.indexOf("audio/")||0===c.type.indexOf("video/"))&&b.push(c.type)})});c.bind("update",function(e){var g=e.file,f=g.mime;-1!==$.inArray(g.mime,b)&&(e.stopImmediatePropagation(),(e=0===f.indexOf("video/"))&&a.hideinfo(),d=$('<embed src="'+a.fm.url(g.hash)+
'" type="'+f+'" class="elfinder-quicklook-preview-'+(e?"video":"audio")+'"/>').appendTo(c))}).bind("change",function(){d&&d.parent().length&&(d.remove(),d=null)})}];
elFinder.prototype.commands.reload=function(){this.updateOnSelect=this.alwaysEnabled=!0;this.shortcuts=[{pattern:"ctrl+shift+r f5"}];this.getstate=function(){return 0};this.exec=function(){var a=this.fm,c=a.sync(),b=setTimeout(function(){a.notify({type:"reload",cnt:1,hideCnt:!0});c.always(function(){a.notify({type:"reload",cnt:-1})})},a.notifyDelay);return c.always(function(){clearTimeout(b);a.trigger("reload")})}};
elFinder.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+("mac"==this.fm.OS?" enter":"")}];this.getstate=function(){var a=this.fm.selectedFiles();return!this._disabled&&1==a.length&&a[0].phash&&!a[0].locked?0:-1};this.exec=function(){var a=this.fm,c=a.getUI("cwd"),b=a.selected(),d=b.length,e=a.file(b.shift()),g=$.Deferred().fail(function(b){var d=f.parent(),g=a.escape(e.name);d.length?(f.remove(),d.html(g)):(c.find("#"+e.hash).find(".elfinder-cwd-filename").html(g),setTimeout(function(){c.find("#"+
e.hash).click()},50));b&&a.error(b)}).always(function(){a.enable()}),f=$('<input type="text"/>').keydown(function(a){a.stopPropagation();a.stopImmediatePropagation();a.keyCode==$.ui.keyCode.ESCAPE?g.reject():a.keyCode==$.ui.keyCode.ENTER&&f.blur()}).mousedown(function(a){a.stopPropagation()}).dblclick(function(a){a.stopPropagation();a.preventDefault()}).blur(function(){var b=$.trim(f.val()),c=f.parent();if(c.length){f[0].setSelectionRange&&f[0].setSelectionRange(0,0);if(b==e.name)return g.reject();
if(!b)return g.reject("errInvName");if(a.fileByName(b,e.phash))return g.reject(["errExists",b]);c.html(a.escape(b));a.lockfiles({files:[e.hash]});a.request({data:{cmd:"rename",target:e.hash,name:b},notify:{type:"rename",cnt:1}}).fail(function(){g.reject();a.sync()}).done(function(a){g.resolve(a)}).always(function(){a.unlockfiles({files:[e.hash]})})}}),b=c.find("#"+e.hash).find(".elfinder-cwd-filename").empty().append(f.val(e.name)),h=f.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/ig,
"");if(this.disabled())return g.reject();if(!e||1<d||!b.length)return g.reject("errCmdParams",this.title);if(e.locked)return g.reject(["errLocked",e.name]);a.one("select",function(){f.parent().length&&e&&-1===$.inArray(e.hash,a.selected())&&f.blur()});f.select().focus();f[0].setSelectionRange&&f[0].setSelectionRange(0,h.length);return g}};
elFinder.prototype.commands.resize=function(){this.updateOnSelect=!1;this.getstate=function(){var a=this.fm.selectedFiles();return!this._disabled&&1==a.length&&a[0].read&&a[0].write&&-1!==a[0].mime.indexOf("image/")?0:-1};this.exec=function(a){var c=this.fm,b=this.files(a),d=$.Deferred(),e;if(!b.length||-1===b[0].mime.indexOf("image/"))return d.reject();a="resize-"+c.namespace+"-"+b[0].hash;e=c.getUI().find("#"+a);if(e.length)return e.elfinderdialog("toTop"),d.resolve();var g=b[0],f=$('<div class="elfinder-dialog-resize"/>'),
h=$('<div class="elfinder-resize-control"/>'),j=$('<div class="elfinder-resize-preview"/>'),l=$('<div class="elfinder-resize-spinner">'+c.i18n("ntfloadimg")+"</div>"),k=$('<div class="elfinder-resize-handle"/>'),m=$('<div class="elfinder-resize-handle"/>'),p=$('<div class="elfinder-resize-uiresize"/>'),r=$('<div class="elfinder-resize-uicrop"/>'),n=$('<div class="elfinder-resize-rotate"/>'),b=$('<div class="ui-state-default elfinder-button"/>').attr("title",c.i18n("rotate-cw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>').click(function(){M-=
90;q.update(M)}));e=$('<div class="ui-state-default elfinder-button"/>').attr("title",c.i18n("rotate-ccw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>').click(function(){M+=90;q.update(M)}));var x=$("<span />"),s=$('<div class="ui-state-default ui-corner-all elfinder-resize-reset"><span class="ui-icon ui-icon-arrowreturnthick-1-w"/></div>'),y=$('<div class="elfinder-resize-type"/>').append('<input type="radio" name="type" id="type-resize" value="resize" checked="checked" /><label for="type-resize">'+
c.i18n("resize")+"</label>").append('<input type="radio" name="type" id="type-crop"   value="crop"/><label for="type-crop">'+c.i18n("crop")+"</label>").append('<input type="radio" name="type" id="type-rotate" value="rotate"/><label for="type-rotate">'+c.i18n("rotate")+"</label>");$("input",y).change(function(){var a=$("input:checked",y).val();X();A(!0);W(!0);Y(!0);"resize"==a?(p.show(),n.hide(),r.hide(),A()):"crop"==a?(n.hide(),p.hide(),r.show(),W()):"rotate"==a&&(p.hide(),r.hide(),n.show(),Y())});
var u=$('<input type="checkbox" checked="checked"/>').change(function(){L=!!u.prop("checked");N.fixHeight();A(!0);A()}),D=$('<input type="text" size="5"/>').change(function(){var a=parseInt(D.val()),b=parseInt(L?a/v:E.val());0<a&&0<b&&(N.updateView(a,b),E.val(b))}),E=$('<input type="text" size="5"/>').change(function(){var a=parseInt(E.val()),b=parseInt(L?a*v:D.val());0<b&&0<a&&(N.updateView(b,a),D.val(b))}),Q=$('<input type="text" size="5"/>'),J=$('<input type="text" size="5"/>'),K=$('<input type="text" size="5"/>'),
F=$('<input type="text" size="5"/>'),C=$('<input type="text" size="3" maxlength="3" value="0" />').change(function(){q.update()}),G=$('<div class="elfinder-resize-rotate-slider"/>').slider({min:0,max:359,value:C.val(),animate:!0,change:function(a,b){b.value!=G.slider("value")&&q.update(b.value)},slide:function(a,b){q.update(b.value,!1)}}),v=1,w=1,t=0,H=0,L=!0,B=0,O=0,V=0,S=0,M=0,z=$("<img/>").load(function(){l.remove();t=z.width();H=z.height();v=t/H;N.updateView(t,H);k.append(z.show()).show();D.val(t);
E.val(H);var a=Math.min(B,O)/Math.sqrt(Math.pow(t,2)+Math.pow(H,2));V=t*a;S=H*a;h.find("input,select").removeAttr("disabled").filter(":text").keydown(function(a){var b=a.keyCode,c;a.stopPropagation();37<=b&&40>=b||(b==$.ui.keyCode.BACKSPACE||b==$.ui.keyCode.DELETE||65==b&&(a.ctrlKey||a.metaKey)||27==b)||(9==b&&(c=$(this).parent()[a.shiftKey?"prev":"next"](".elfinder-resize-row").children(":text"),c.length&&c.focus()),13==b?aa():48<=b&&57>=b||96<=b&&105>=b||a.preventDefault())}).filter(":first").focus();
A();s.hover(function(){s.toggleClass("ui-state-hover")}).click(X)}).error(function(){l.text("Unable to load image").css("background","transparent")}),T=$("<div/>"),P=$("<img/>"),U=$("<div/>"),I=$("<img/>"),X=function(){D.val(t);E.val(H);N.updateView(t,H)},N={update:function(){D.val(parseInt(z.width()/w));E.val(parseInt(z.height()/w))},updateView:function(a,b){a>B||b>O?a/B>b/O?z.width(B).height(Math.ceil(z.width()/v)):z.height(O).width(Math.ceil(z.height()*v)):z.width(a).height(b);w=z.width()/a;x.text("1 : "+
(1/w).toFixed(2));N.updateHandle()},updateHandle:function(){k.width(z.width()).height(z.height())},fixWidth:function(){var a;L&&(a=E.val(),a=parseInt(a*v),N.updateView(void 0,a),D.val(void 0))},fixHeight:function(){var a,b;L&&(a=D.val(),b=parseInt(a/v),N.updateView(a,b),E.val(b))}},R={update:function(){K.val(parseInt(m.width()/w));F.val(parseInt(m.height()/w));Q.val(parseInt((m.offset().left-P.offset().left)/w));J.val(parseInt((m.offset().top-P.offset().top)/w))},resize_update:function(){R.update();
U.width(m.width());U.height(m.height())}},q={mouseStartAngle:0,imageStartAngle:0,imageBeingRotated:!1,update:function(a,b){"undefined"==typeof a&&(M=a=parseInt(C.val()));"undefined"==typeof b&&(b=!0);!b||c.UA.Opera||c.UA.ltIE8?I.rotate(a):I.animate({rotate:a+"deg"});a%=360;0>a&&(a+=360);C.val(parseInt(a));G.slider("value",C.val())},execute:function(a){if(q.imageBeingRotated){var b=q.getCenter(I),b=Math.atan2(a.pageY-b[1],a.pageX-b[0])-q.mouseStartAngle+q.imageStartAngle,b=Math.round(180*parseFloat(b)/
Math.PI);a.shiftKey&&(b=15*Math.round((b+6)/15));I.rotate(b);b%=360;0>b&&(b+=360);C.val(b);G.slider("value",C.val());return!1}},start:function(a){q.imageBeingRotated=!0;var b=q.getCenter(I);q.mouseStartAngle=Math.atan2(a.pageY-b[1],a.pageX-b[0]);q.imageStartAngle=parseFloat(I.rotate())*Math.PI/180;$(document).mousemove(q.execute);return!1},stop:function(){if(q.imageBeingRotated)return $(document).unbind("mousemove",q.execute),setTimeout(function(){q.imageBeingRotated=!1},10),!1},getCenter:function(){var a=
I.rotate();I.rotate(0);var b=I.offset(),c=b.left+I.width()/2,b=b.top+I.height()/2;I.rotate(a);return[c,b]}},A=function(a){$.fn.resizable&&(a?(k.filter(":ui-resizable").resizable("destroy"),k.hide()):(k.show(),k.resizable({alsoResize:z,aspectRatio:L,resize:N.update,stop:N.fixHeight})))},W=function(a){$.fn.draggable&&$.fn.resizable&&(a?(m.filter(":ui-resizable").resizable("destroy"),m.filter(":ui-draggable").draggable("destroy"),T.hide()):(P.width(z.width()).height(z.height()),U.width(z.width()).height(z.height()),
m.width(P.width()).height(P.height()).offset(P.offset()).resizable({containment:T,resize:R.resize_update,handles:"all"}).draggable({handle:m,containment:P,drag:R.update}),T.show().width(z.width()).height(z.height()),R.update()))},Y=function(a){$.fn.draggable&&$.fn.resizable&&(a?I.hide():I.show().width(V).height(S).css("margin-top",(O-S)/2+"px").css("margin-left",(B-V)/2+"px"))},aa=function(){var a,b,e,h,j,k=$("input:checked",y).val();D.add(E).change();if("resize"==k)a=parseInt(D.val())||0,b=parseInt(E.val())||
0;else if("crop"==k)a=parseInt(K.val())||0,b=parseInt(F.val())||0,e=parseInt(Q.val())||0,h=parseInt(J.val())||0;else{k="rotate";a=t;b=H;j=parseInt(C.val())||0;if(0>j||360<j)return c.error("Invalid rotate degree");if(0==j||360==j)return c.error("Image dose not rotated")}if("rotate"!=k){if(0>=a||0>=b)return c.error("Invalid image size");if(a==t&&b==H)return c.error("Image size not changed")}f.elfinderdialog("close");c.request({data:{cmd:"resize",target:g.hash,width:a,height:b,x:e,y:h,degree:j,mode:k},
notify:{type:"resize",cnt:1}}).fail(function(a){d.reject(a)}).done(function(){d.resolve()})},Z={},ba=c.url(g.hash);I.mousedown(q.start);$(document).mouseup(q.stop);p.append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text(c.i18n("width"))).append(D).append(s)).append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text(c.i18n("height"))).append(E)).append($('<div class="elfinder-resize-row"/>').append($("<label/>").text(c.i18n("aspectRatio")).prepend(u))).append($('<div class="elfinder-resize-row"/>').append(c.i18n("scale")+
" ").append(x));r.append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text("X")).append(Q)).append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text("Y")).append(J)).append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text(c.i18n("width"))).append(K)).append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text(c.i18n("height"))).append(F));
n.append($('<div class="elfinder-resize-row"/>').append($('<div class="elfinder-resize-label"/>').text(c.i18n("rotate"))).append($('<div style="float:left; width: 130px;">').append($('<div style="float:left;">').append(C).append($("<span/>").text(c.i18n("degree")))).append($('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>').append(b).append($('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')).append(e))).append(G));f.append(y);h.append($('<div class="elfinder-resize-row"/>')).append(p).append(r.hide()).append(n.hide()).find("input,select").attr("disabled",
"disabled");k.append('<div class="elfinder-resize-handle-hline elfinder-resize-handle-hline-top"/>').append('<div class="elfinder-resize-handle-hline elfinder-resize-handle-hline-bottom"/>').append('<div class="elfinder-resize-handle-vline elfinder-resize-handle-vline-left"/>').append('<div class="elfinder-resize-handle-vline elfinder-resize-handle-vline-right"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-e"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-se"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-s"/>');
j.append(l).append(k.hide()).append(z.hide());m.css("position","absolute").append('<div class="elfinder-resize-handle-hline elfinder-resize-handle-hline-top"/>').append('<div class="elfinder-resize-handle-hline elfinder-resize-handle-hline-bottom"/>').append('<div class="elfinder-resize-handle-vline elfinder-resize-handle-vline-left"/>').append('<div class="elfinder-resize-handle-vline elfinder-resize-handle-vline-right"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-n"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-e"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-s"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-w"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-ne"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-se"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-sw"/>').append('<div class="elfinder-resize-handle-point elfinder-resize-handle-point-nw"/>');
j.append(T.css("position","absolute").hide().append(P).append(m.append(U)));j.append(I.hide());j.css("overflow","hidden");f.append(j).append(h);Z[c.i18n("btnCancel")]=function(){f.elfinderdialog("close")};Z[c.i18n("btnApply")]=aa;c.dialog(f,{title:g.name,width:650,resizable:!1,destroyOnClose:!0,buttons:Z,open:function(){j.zIndex(1+$(this).parent().zIndex())}}).attr("id",a);c.UA.ltIE8&&$(".elfinder-dialog").css("filter","");s.css("left",D.position().left+D.width()+12);U.css({opacity:0.2,"background-color":"#fff",
position:"absolute"});m.css("cursor","move");m.find(".elfinder-resize-handle-point").css({"background-color":"#fff",opacity:0.5,"border-color":"#000"});I.css("cursor","pointer");y.buttonset();B=j.width()-(k.outerWidth()-k.width());O=j.height()-(k.outerHeight()-k.height());z.attr("src",ba+(-1===ba.indexOf("?")?"?":"&")+"_="+Math.random());P.attr("src",z.attr("src"));I.attr("src",z.attr("src"));return d}};
(function(a){var c=function(a,b){var c=0;for(c in b)if("undefined"!=typeof a[b[c]])return b[c];a[b[c]]="";return b[c]};a.cssHooks.rotate={get:function(b){return a(b).rotate()},set:function(b,c){a(b).rotate(c);return c}};a.cssHooks.transform={get:function(a){var b=c(a.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return a.style[b]},set:function(a,b){var g=c(a.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return a.style[g]=b}};a.fn.rotate=
function(a){if("undefined"==typeof a)return window.opera?(a=this.css("transform").match(/rotate\((.*?)\)/))&&a[1]?Math.round(180*parseFloat(a[1])/Math.PI):0:(a=this.css("transform").match(/rotate\((.*?)\)/))&&a[1]?parseInt(a[1]):0;this.css("transform",this.css("transform").replace(/none|rotate\(.*?\)/,"")+"rotate("+parseInt(a)+"deg)");return this};a.fx.step.rotate=function(b){0==b.state&&(b.start=a(b.elem).rotate(),b.now=b.start);a(b.elem).rotate(b.now)};if("undefined"==typeof window.addEventListener&&
"undefined"==typeof document.getElementsByClassName){var b=a.cssHooks.transform.set;a.cssHooks.transform.set=function(a,c){b.apply(this,[a,c]);var g,f=1,h=1,j=1,l=1;if("undefined"==typeof a.style.msTransform){if("static"==a.currentStyle.position){g=a;for(var k=g.offsetLeft,m=g.offsetTop;g.offsetParent;){g=g.offsetParent;if(g!=document.body&&"static"!=g.currentStyle.position)break;g!=document.body&&g!=document.documentElement&&(k-=g.scrollLeft,m-=g.scrollTop);k+=g.offsetLeft;m+=g.offsetTop}a.style.position=
"absolute";a.style.left=k+"px";a.style.top=m+"px"}g=(g=c.match(/rotate\((.*?)\)/))&&g[1]?parseInt(g[1]):0;g%=360;0>g&&(g=360+g);k=g*Math.PI/180;m=Math.cos(k);k=Math.sin(k);f*=m;h*=-k;j*=k;l*=m;a.style.filter=(a.style.filter||"").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/,"")+("progid:DXImageTransform.Microsoft.Matrix(M11="+f+",M12="+h+",M21="+j+",M22="+l+",FilterType='bilinear',sizingMethod='auto expand')");f=parseInt(a.style.width||a.width||0);h=parseInt(a.style.height||a.height||
0);k=g*Math.PI/180;j=Math.abs(Math.cos(k));l=Math.abs(Math.sin(k));a.style.marginLeft=Math.floor((f-(f*j+h*l))/2)+"px";a.style.marginTop=Math.floor((h-(f*l+h*j))/2)+"px"}return c}}})(jQuery);
elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}];this.getstate=function(a){var c=this.fm;a=a||c.selected();return!this._disabled&&a.length&&$.map(a,function(a){var d=c.file(a);return d&&d.phash&&!d.locked?a:null}).length==a.length?0:-1};this.exec=function(a){var c=this.fm,b=$.Deferred().fail(function(a){a&&c.error(a)}),d=this.files(a),e=d.length,g=c.cwd().hash,f=!1;if(!e||this._disabled)return b.reject();$.each(d,function(a,d){if(!d.phash)return!b.reject(["errRm",
d.name,"errPerm"]);if(d.locked)return!b.reject(["errLocked",d.name]);d.hash==g&&(f=c.root(d.hash))});"pending"==b.state()&&(d=this.hashes(a),c.confirm({title:this.title,text:"confirmRm",accept:{label:"btnRm",callback:function(){c.lockfiles({files:d});c.request({data:{cmd:"rm",targets:d},notify:{type:"rm",cnt:e},preventFail:!0}).fail(function(a){b.reject(a)}).done(function(a){b.done(a);f&&c.exec("open",f)}).always(function(){c.unlockfiles({files:d})})}},cancel:{label:"btnCancel",callback:function(){b.reject()}}}));
return b}};elFinder.prototype.commands.search=function(){this.title="Find files";this.options={ui:"searchbutton"};this.alwaysEnabled=!0;this.updateOnSelect=!1;this.getstate=function(){return 0};this.exec=function(a){var c=this.fm;if("string"==typeof a&&a)return c.trigger("searchstart",{query:a}),c.request({data:{cmd:"search",q:a},notify:{type:"search",cnt:1,hideCnt:!0}});c.getUI("toolbar").find("."+c.res("class","searchbtn")+" :text").focus();return $.Deferred().reject()}};
elFinder.prototype.commands.sort=function(){this.options={ui:"sortbutton"};this.getstate=function(){return 0};this.exec=function(a,c){var b=this.fm;c=$.extend({type:b.sortType,order:b.sortOrder,stick:b.sortStickFolders},c);this.fm.setSort(c.type,c.order,c.stick);return $.Deferred().resolve()}};
elFinder.prototype.commands.up=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+up"}];this.getstate=function(){return this.fm.cwd().phash?0:-1};this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):$.Deferred().reject()}};
elFinder.prototype.commands.upload=function(){var a=this.fm.res("class","hover");this.disableOnSearch=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+u"}];this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1};this.exec=function(c){var b=this.fm,d=function(a){g.elfinderdialog("close");b.upload(a).fail(function(a){e.reject(a)}).done(function(a){e.resolve(a)})},e,g,f,h,j,l;if(this.disabled())return $.Deferred().reject();if(c&&(c.input||c.files))return b.upload(c);e=$.Deferred();
f=$('<input type="file" multiple="true"/>').change(function(){d({input:f[0]})});h=$('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+b.i18n("selectForUpload")+"</span></div>").append($("<form/>").append(f)).hover(function(){h.toggleClass(a)});g=$('<div class="elfinder-upload-dialog-wrapper"/>').append(h);l=$('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable=true></div>').focus(function(){if(this.innerHTML){var a=
this.innerHTML.replace(/<br[^>]*>/gi," "),b=a.match(/<[^>]+>/)?"html":"text";this.innerHTML="";d({files:[a],type:b})}}).bind("dragenter mouseover",function(){this.focus();$(l).addClass(a)}).bind("dragleave mouseout",function(){this.blur();$(l).removeClass(a)}).bind("mouseup keyup",function(){setTimeout(function(){$(l).focus()},100)});b.dragUpload?(j=$('<div class="ui-corner-all elfinder-upload-dropbox">'+b.i18n("dropFiles")+"</div>").prependTo(g).after('<div class="elfinder-upload-dialog-or">'+b.i18n("or")+
"</div>").after(l).after("<div>"+b.i18n("dropFilesBrowser")+"</div>").after('<div class="elfinder-upload-dialog-or">'+b.i18n("or")+"</div>")[0],j.addEventListener("dragenter",function(b){b.stopPropagation();b.preventDefault();$(j).addClass(a)},!1),j.addEventListener("dragleave",function(b){b.stopPropagation();b.preventDefault();$(j).removeClass(a)},!1),j.addEventListener("dragover",function(b){b.stopPropagation();b.preventDefault();$(j).addClass(a)},!1),j.addEventListener("drop",function(a){a.stopPropagation();
a.preventDefault();var b=!1,c="";a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files.length?(b=a.dataTransfer.files,c="files"):a.dataTransfer.getData("text/html")?(b=[a.dataTransfer.getData("text/html")],c="html"):a.dataTransfer.getData("text")&&(b=[a.dataTransfer.getData("text")],c="text");b&&d({files:b,type:c})},!1)):$("<div>"+b.i18n("dropFilesBrowser")+"</div>").append(l).prependTo(g).after('<div class="elfinder-upload-dialog-or">'+b.i18n("or")+"</div>")[0];b.dialog(g,{title:this.title,
modal:!0,resizable:!1,destroyOnClose:!0});return e}};elFinder.prototype.commands.view=function(){this.value=this.fm.viewType;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.options={ui:"viewbutton"};this.getstate=function(){return 0};this.exec=function(){var a=this.fm.storage("view","list"==this.value?"icons":"list");this.fm.viewchange();this.update(void 0,a)}};